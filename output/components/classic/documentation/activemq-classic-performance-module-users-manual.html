<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>ActiveMQ</title>
    <link rel="icon" type="image/png" href="/assets/img/favicon.png">

    <link rel="stylesheet" href="/css/main.css">
    <script defer src="/js/fontawesome-all.min.js" integrity="sha384-rOA1PnstxnOBLzCLMcre8ybwbTmemjzdNlILg8O7z1lUkLXozs4DHonlDtnE7fpc"></script>
    <script src="/js/jquery.slim.min.js" integrity="sha384-5AkRS45j4ukf+JbWAfHL8P4onPA9p0KwwP7pUdjSQA3ss9edbJUJc/XcYAiheSSz"></script>
    <script src="/js/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q"></script>
    <script src="/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl"></script>
</head>

<body>
<nav class="navbar navbar-expand-lg navbar-light fixed-top">
    <div class="container">
        <!-- <a class="navbar-brand mr-auto" href="#"><img style="height: 50px" src="assets/img/apache-feather.png" /></a> -->
        <a class="navbar-brand mr-auto" href="/"><img src="/assets/img/activemq_logo_black_small.png" style="height: 50px"/></a>
        <button class="navbar-toggler ml-auto" type="button" data-toggle="collapse" data-target="#navbarContent" aria-controls="navbarContent" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>

        <div class="ml-auto collapse navbar-collapse" id="navbarContent">
            <ul class="navbar-nav ml-auto">
                <li class="nav-item">
                    <a class="nav-link active" href="/news">News</a>
                </li>
                <li class="nav-item dropdown">
                    <a class="nav-link" id="navbarDropdownComponents" data-target="#" href="" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Components<span class="caret"></span></a>
                    <ul class="dropdown-menu dropdown-menu-center" aria-labelledby="navbarDropdownComponents">
                        <div class="row">
                            <div class="col-12">
                                <ul class="multi-column-dropdown">
                                    <li class="nav-item"><a class="dropdown-item" href="/components/classic">ActiveMQ Classic</a></li>
                                    <li class="nav-item"><a class="dropdown-item" href="/components/artemis/">ActiveMQ Artemis</a></li>
                                    <li class="nav-item"><a class="dropdown-item" href="/components/artemis-console/">ActiveMQ Artemis Console</a></li>
                                    <li class="nav-item"><a class="dropdown-item" href="/components/nms">NMS Clients</a></li>
                                    <li class="nav-item"><a class="dropdown-item" href="/components/cms">CMS Client</a></li>
                                </ul>
                            </div>
                        </div>
                    </ul>
                </li>
                <li class="nav-item dropdown">
                    <a class="nav-link" id="navbarDropdownCommunity" data-target="#" href="" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Community<span class="caret"></span></a>
                    <ul class="dropdown-menu dropdown-menu-center multi-column columns-1" aria-labelledby="navbarDropdownCommunity">
                        <div class="row">
                            <div class="col-12">
                                <ul class="multi-column-dropdown">
                                    <li class="nav-item"><a class="dropdown-item" href="/contact">Contact Us</a></li>
                                    <li class="nav-item"><a class="dropdown-item" href="/contributing">Contribute</a></li>
                                    <li class="nav-item"><a class="dropdown-item" href="/issues">Report Issues</a></li>
                                    <li class="nav-item"><a class="dropdown-item" href="/support">Get Support</a></li>
                                </ul>
                            </div>
                          </div>
                    </ul>
                </li>
                <li class="nav-item dropdown">
                    <a class="nav-link" id="navbarDropdownTeam" data-target="#" href="" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"><img src="/assets/img/feather.png" style="height:20px">Apache<span class="caret"></span></a>
                    <ul class="dropdown-menu dropdown-menu-center multi-column columns-1" aria-labelledby="navbarDropdownTeam">
                        <div class="row">
                            <div class="col-sm-12">
                                <ul class="multi-column-dropdown">
                                    <li class="nav-item"><a class="dropdown-item" href="https://www.apache.org">The Apache Software Foundation</a></li>
                                    <li class="nav-item"><a class="dropdown-item" href="https://www.apache.org/licenses/">License</a></li>
                                    <li class="nav-item"><a class="dropdown-item" href="https://www.apache.org/foundation/sponsorship.html">Sponsorship</a></li>
                                    <li class="nav-item"><a class="dropdown-item" href="https://www.apache.org/foundation/thanks.html">Thanks</a></li>
                                    <li class="nav-item"><a class="dropdown-item" href="/security-advisories">Security</a></li>
                                    <li class="nav-item"><a class="dropdown-item" href="https://www.apache.org/events/current-event">Events</a></li>
                                    <li class="nav-item"><a class="dropdown-item" href="https://people.apache.org/phonebook.html?pmc=activemq">PMC & Committers</a></li>
                                    <li class="nav-item"><a class="dropdown-item" href="https://whimsy.apache.org/board/minutes/ActiveMQ.html">Board Reports</a></li>
                                    <li class="nav-item"><a class="dropdown-item" href="https://privacy.apache.org/policies/privacy-policy-public.html">Privacy Policy</a></li>
                                </ul>
                            </div>
                        </div>
                    </ul>
                </li>
            </ul>
        </div>
    </div>
</nav>

<div class="content">
  <div class="page-title-classic">
    <div class="container">
      <h1>ActiveMQ Classic Performance Module Users Manual</h1>
    </div>
  </div>
  <div class="container" >
    <div class="row" style="margin-top: 30px">
      <div class="col-12 classic">
        <p><a href="features">Features</a> &gt; <a href="performance">Performance</a> &gt; <a href="activemq-classic-performance-module-users-manual">ActiveMQ Classic Performance Module Users Manual</a></p>

<h2 id="running-maven-2-performance-test">Running Maven 2 Performance Test</h2>

<p>This <a href="http://maven.apache.org">Maven 2</a> plugin allows you to run performance tests easily using the Maven command line or run tests automatically in <a href="http://maven.apache.org/continuum/">Continuum</a></p>

<h3 id="prerequisites">Prerequisites</h3>

<p>Starting with ActiveMQ Classic 5.5 and above the plugin can be obtained from maven or if you download the src from GIT you can build it yourself. Start with a complete build of Apache ActiveMQ Classic and then do</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>cd activemq-tooling
mvn clean install
</code></pre></div></div>
<p>To run the following Maven goals make sure you are inside a Maven2 project directory where its POM is enabled with the Maven2 plugin.</p>

<h3 id="getting-started">Getting started</h3>

<p>To get started, switch to the <a href="http://svn.apache.org/repos/asf/activemq/sandbox/activemq-perftest/">activemq-perftest directory from the sandbox repo,</a> or to a directory containing your own Maven POM with the following plugin defined:</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&lt;plugin&gt;
  &lt;groupId&gt;org.apache.activemq.tooling&lt;/groupId&gt;
  &lt;artifactId&gt;activemq-perf-maven-plugin&lt;/artifactId&gt;
  &lt;version&gt;${activemq-version}&lt;/version&gt;
&lt;/plugin&gt;
</code></pre></div></div>
<p>In ActiveMQ Classic versions prior to 5.8, the artifactId was <code class="language-plaintext highlighter-rouge">maven-activemq-perf-plugin</code>.</p>

<p>Type the following commands into separate shells (the broker line here is optional if you have a preconfigured one running):</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>mvn activemq-perf:broker -Durl=broker:tcp://localhost:61616
mvn activemq-perf:consumer
mvn activemq-perf:producer
</code></pre></div></div>
<p>If you run the broker on a different machine then change the producer and consumer commands to</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>mvn activemq-perf:consumer -Dfactory.brokerURL=tcp://host:port
mvn activemq-perf:producer -Dfactory.brokerURL=tcp://host:port
</code></pre></div></div>
<p>where you switch host:port with the actual values.</p>

<p>When you run the producer &amp; consumer, it generates an XML performance report in the current directory, so that you can graph and chart the results etc. See the <a href="ActiveMQ Classic Performance Module Users Manual/sample-report">sample report</a></p>

<h3 id="maven-goals">Maven goals</h3>

<table>
  <thead>
    <tr>
      <th>Goal</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">activemq-perf:broker</code></td>
      <td>Starts broker using the activemq configuration file located in “src\main\resources\broker-conf” where the default config is activemq.xml.  Parameters:  <code class="language-plaintext highlighter-rouge">-DconfigType</code> - specifies the type of configuration to use. Its value must be one of the filename in the “..\broker-config” directory (e.g. -DconfigType=kaha).  <code class="language-plaintext highlighter-rouge">-DconfigFile</code> - path to config file other than those in “src\..\broker-config”.e.g -DconfigFile=c:\dir\activemq.xml)</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">activemq-perf:consumer</code></td>
      <td>Starts the consumer’s performance testing. The generated report file can be found in the directory specified in the parameter “sysTest.reportDir”.</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">activemq-perf:producer</code></td>
      <td>Starts the producer’s performance testing. The generated report file can be found in the directory specified in the parameter “sysTest.reportDir”.</td>
    </tr>
  </tbody>
</table>

<blockquote>
  <p><strong>Note</strong>:The parameters for both consumer and producers are described in the next section. (<a href="sample-report">sample report</a>)</p>
</blockquote>

<h3 id="configuration-for-running-a-system-of-jms-clients-producerconsumer">Configuration for running a system of JMS Clients (Producer/Consumer)</h3>

<table>
  <thead>
    <tr>
      <th>Configuration Key</th>
      <th>Default Value</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">sysTest.propsConfigFile</code></td>
      <td>null</td>
      <td>Use properties specified externally in a key=value properties file</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">sysTest.clientPrefix</code></td>
      <td>JmsConsumer or JmsProducer</td>
      <td>Specifies the client name prefix that will be use for each system. By default it will use JmsConsumer for consumer systems, and JmsProducer for producer systems.</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">sysTest.numClients</code></td>
      <td>1</td>
      <td>Specifies the number of JMS Clients to start.</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">sysTest.totalDests</code></td>
      <td>1</td>
      <td>Specifies the total number of destinations to use for the whole system test.</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">sysTest.destDistro</code></td>
      <td>all</td>
      <td>Specifies how to distribute the destinations to the clients. Available values are (Invalid value will result to using the default value ‘all’): ‘all’ - All clients will send/receive to all destinations. i.e. if there are 2 producers and 5 destinations, each producer will send a message to each individual destination. ‘equal’ - Clients will equally divide the destinations among themselves. i.e. if there are 2 producers and 5 destinations, each producer will send messages to 2 destinations. The fifth destination will not be used. ‘divide’ - Clients will divide the destinations among themselves regardless of equality. i.e. if there are 2 producers and 5 destinations, producer 1 will send to 3 destinations, while producer 2 will send to 2 destinations.</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">sysTest.reportDir</code></td>
      <td>./</td>
      <td>The directory where the sampler report will be saved.</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">sysTest.reportName</code></td>
      <td>null</td>
      <td>The default filename the sampler report will be saved us. There is usually no need to set this setting as the default value will create either JmsProducer_numClients#<em>numDests#</em><Dest Distro="">.xml and JmsConsumer\_numClients#\_numDests#_<Dest Distro="">.xml, where # represents the number of clients and destinations set for that system, and <Dest Distro=""> specifies the destination distribution for the system.</Dest></Dest></Dest></td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">sysTest.reportType</code></td>
      <td>xml</td>
      <td>Specifies the manner of generating the performance report. Available values are: ‘xml’ - Write the performance report into an xml file. Specified by reportDirectory and reportName. A verbose summary will also be displayed at the end of the test. ‘verbose’ - All information will be written to the standard output, which includes settings, sampler data, and performance summary.</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">sysTest.samplers</code></td>
      <td>tp,cpu</td>
      <td>Specifies the samplers that will be started. To use enable more than one sampler, separate the values by commas without spaces. Available values are: ‘tp’ - Throughput sampler. ‘cpu’ - CPU Usage sampler</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">sysTest.spiClass</code></td>
      <td>org.apache.activemq.tool.spi.ActiveMQClassLoaderSPI</td>
      <td>The service provider interface class that allows the client to create a generic connection factory. Current available SPI classes include: ‘org.apache.activemq.tool.ActiveMQPojoSPI’ and ‘org.apache.activemq.tool.ActiveMQClassLoaderSPI’</td>
    </tr>
  </tbody>
</table>

<blockquote>
  <p><strong>Note</strong>: If the number of destinations is less than the number of clients and the distribution type is either ‘equal’ or ‘divide’, each client will send/receive from only one destination, distributing the destinations among the clients. i.e. if there are 5 producers and 2 destinations, 3 producers will send to destination 1, and 2 producers will send to destination 2. Also, a consumer can only receive from a single destination, unless composite destination is supported and specified.</p>
</blockquote>

<h3 id="configuration-for-running-a-jms-producer">Configuration for running a JMS Producer</h3>

<table>
  <thead>
    <tr>
      <th>Configuration Key</th>
      <th>Default Value</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">producer.sessTransacted</code></td>
      <td>false</td>
      <td>Specifies if the session created will be transacted or not. See the JMS Specifications for more details.</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">producer.sessAckMode</code></td>
      <td>autoAck</td>
      <td>Specified the acknowledge mode of the session. See the JMS Specifications for more details. Available values are: ‘autoAck’ - Session.AUTO_ACKNOWLEDGE. ‘clientAck’ - Session.CLIENT_ACKNOWLEDGE. ‘dupsAck’ - Session.DUPS_OK_ACKNOWLEDGE. ‘transacted’ - Session.TRANSACTED</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">producer.commitAfterXMsgs</code></td>
      <td>1</td>
      <td>Commit transaction after the specified amount of messages. Only used in conjunction with a transacted JMS Session (producer.sessTransacted=true and producer.sessAckMode=transacted)</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">producer.destName</code></td>
      <td>TEST.FOO</td>
      <td>The prefix of the destination name to use. To specify a queue, prefix the destination name with ‘queue://’, for topics, prefix the destination with ‘topic://’. If no prefix is specified, a topic will be created.</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">producer.destComposite</code></td>
      <td>false</td>
      <td>If there are more than one destination, and destComposite=true, the destinations will be merged into one. This assumes that the provider supports composite destinations.</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">producer.deliveryMode</code></td>
      <td>nonpersistent</td>
      <td>The message delivery mode that will be used for each producer. Available values are: ‘nonpersistent’ - use non-persistent delivery mode. javax.jms.DeliveryMode.NON_PERSISTENT. ‘persistent’ - use persistent delivery mode. javax.jms.DeliveryMode.PERSISTENT.</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">producer.messageSize</code></td>
      <td>1024 bytes</td>
      <td>The size of each text message to send.</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">producer.msgFileName</code></td>
      <td>null</td>
      <td>If you want to send a fixed message from a particular file. The file needs to be a text file. The entire content of the file will be sent as message body. Specifying a file containing the message to be sent makes the producer ignore the property producer.messageSize. Use relative or full path. Example: -Dproducer.msgFileName=../message.xml</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">producer.createNewMsg</code></td>
      <td>false</td>
      <td>If true, each send will create a new JMS Message with the specified message size with incrementing text messages (i.e. Text Message 1, Text Message 2, …). If false, only one message will be created before the send loop, and this message will be sent over and over again.</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">producer.sendDelay</code></td>
      <td>0 ms</td>
      <td>Pause producer for sendDelay milliseconds after each message (allows producer throttling).</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">producer.sendType</code></td>
      <td>time</td>
      <td>Send either time-based or message-count-based. Available values are: ‘time’ - keep sending messages until a specific interval of time elapses. ‘count’ - keep sending messages until N messages has been sent.</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">producer.sendCount</code></td>
      <td>1000000 msgs (1 million)</td>
      <td>If sendType=count, send this number of messages.</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">producer.sendDuration</code></td>
      <td>300000 ms (5 mins)</td>
      <td>If sendType=time, send messages for this number of milliseconds.</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">producer.header</code></td>
      <td>none</td>
      <td>Specify message headers to be set on all messages. Headers use name=value syntax and can be separated using ‘:’. More than one header can be set on a single producer.header line, e.g. producer.header=”JMSType=car:MyHeader=MyValue” (no spaces). Only one producer.header line is allowed!</td>
    </tr>
  </tbody>
</table>

<h3 id="configuration-for-running-a-jms-consumer">Configuration for running a JMS Consumer</h3>

<table>
  <thead>
    <tr>
      <th>Configuration Key</th>
      <th>Default Value</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">consumer.sessTransacted</code></td>
      <td>false</td>
      <td>Specifies if the session created will be transacted or not. See the JMS Specifications for more details.</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">consumer.sessAckMode</code></td>
      <td>autoAck</td>
      <td>Specified the acknowledge mode of the session. See the JMS Specifications for more details. Available values are: ‘autoAck’ - Session.AUTO_ACKNOWLEDGE. ‘clientAck’ - Session.CLIENT_ACKNOWLEDGE. ‘dupsAck’ - Session.DUPS_OK_ACKNOWLEDGE. ‘transacted’ - Session.TRANSACTED</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">consumer.commitAfterXMsgs</code></td>
      <td>1</td>
      <td>Commit transaction after the specified amount of messages. Only used in conjunction with a transacted JMS Session (consumer.sessTransacted=true and consumer.sessAckMode=transacted)</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">consumer.destName</code></td>
      <td>TEST.FOO</td>
      <td>The prefix of the destination name to use. To specify a queue, prefix the destination name with ‘queue://’, for topics, prefix the destination with ‘topic://’. If no prefix is specified, a topic will be created.</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">consumer.destComposite</code></td>
      <td>false</td>
      <td>If there are more than one destination, and destComposite=true, the destinations will be merged into one. This assumes that the provider supports composite destinations.</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">consumer.durable</code></td>
      <td>false</td>
      <td>If true, create a durable subscriber, otherwise create a message consumer. See the JMS Specifications for more details.</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">consumer.asyncRecv</code></td>
      <td>true</td>
      <td>If true, asynchronously receive messages using the onMessage() method, otherwise use the receive() method.</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">consumer.recvDelay</code></td>
      <td>0 ms</td>
      <td>Pause consumer for recvDelay milliseconds with each message (allows consumer throttling).</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">consumer.recvType</code></td>
      <td>time</td>
      <td>Receive either time-based or message-count-based. Available values are: ‘time’ - keep receiving messages until a specific time interval has elapsed. ‘count’ - keep receiving until N messages has been received.</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">consumer.recvCount</code></td>
      <td>1000000 msgs (1 million)</td>
      <td>If recvType=count, receive this much messages.</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">consumer.recvDuration</code></td>
      <td>300000 ms (5 mins)</td>
      <td>If recvType=time, receive messages for this specific time duration.</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">consumer.messageSelector</code></td>
      <td>none</td>
      <td>Specify <a href="selectors">message selector</a> for all consumers. E.g. consumer.messageSelector=”MyHeader = ‘MyValue’ AND JMSType = ‘car’”</td>
    </tr>
  </tbody>
</table>

<blockquote>
  <p><strong>Note</strong>: If you have more than one consumer receiving from multiple destinations, it is a good idea to change the sysTest.destDistro to ‘equal’, since by default it uses ‘all’ and a consumer can only receive from a single destination, hence all consumers will receive from the first destination in the list only.</p>
</blockquote>

<h3 id="configuration-for-spi-connection-factory-orgapacheactivemqtoolspiactivemqpojospi">Configuration for SPI Connection Factory: org.apache.activemq.tool.spi.ActiveMQPojoSPI</h3>

<p><strong>Description:</strong> This provides details in configuring the JMS Connection Factory created by ActiveMQPojoSPI. Default values are based from the default values of the service provider org.apache.activemq.ActiveMQConnectionFactory.</p>

<table>
  <thead>
    <tr>
      <th>Configuration Key</th>
      <th>Default Value</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">factory.brokerURL</code></td>
      <td>tcp://localhost:61616</td>
      <td>The url of the broker the client will connect to.</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">factory.userName</code></td>
      <td>null</td>
      <td>Username on the connection to use.</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">factory.password</code></td>
      <td>null</td>
      <td>Password on the connection to use.</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">factory.clientID</code></td>
      <td>null</td>
      <td>Client ID the connection will use. If none is specified, it will be automatically generated.</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">factory.asyncSend</code></td>
      <td>false</td>
      <td>If true, asynchronously send messages.</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">factory.asyncDispatch</code></td>
      <td>false</td>
      <td>If true, asynchronously dispatch messages.</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">factory.asyncSession</code></td>
      <td>true</td>
      <td>If true, session will dispatch messages asynchronously.</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">factory.closeTimeout</code></td>
      <td>15000 ms</td>
      <td> </td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">factory.copyMsgOnSend</code></td>
      <td>true</td>
      <td>If true, creates a copy of the message to be sent.</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">factory.disableTimestamp</code></td>
      <td>false</td>
      <td>If true, disable the setting of the JMSTimestamp.</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">factory.deferObjSerial</code></td>
      <td>false</td>
      <td>If true, defer the serialization of message objects.</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">factory.optimAck</code></td>
      <td>true</td>
      <td>If true, optimizes the acknowledgement of messages.</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">factory.optimDispatch</code></td>
      <td>true</td>
      <td>If true, optimizes the dispatching of messages.</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">factory.prefetchQueue</code></td>
      <td>1000 messages</td>
      <td>Number of messages a queue consumer will cache in RAM before processing it.</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">factory.prefetchTopic</code></td>
      <td>32766 messages</td>
      <td>Number of messages a topic consumer will cache in RAM before processing it.</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">factory.useCompression</code></td>
      <td>false</td>
      <td>If true, compress message data.</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">factory.useRetroactive</code></td>
      <td>false</td>
      <td>If true, make consumers retroactive.</td>
    </tr>
  </tbody>
</table>

<h3 id="configuration-for-spi-connection-factory-orgapacheactivemqtoolspiactivemqclassloaderspi">Configuration for SPI Connection Factory: <code class="language-plaintext highlighter-rouge">org.apache.activemq.tool.spi.ActiveMQClassLoaderSPI</code></h3>

<p><strong>Description:</strong> This provides details in configuring the JMS Connection Factory created by <code class="language-plaintext highlighter-rouge">ActiveMQClassLoaderSPI</code>. Default values are based from the default values of the service provider org.apache.activemq.ActiveMQConnectionFactory.</p>

<p>ActiveMQClassLoaderSPI loads from the classpath <code class="language-plaintext highlighter-rouge">org.apache.activemq.ActiveMQConnectionFactory</code> and configures it using reflection. Configuration is generally based on the API of the class loaded. General format is <code class="language-plaintext highlighter-rouge">factory.YYY</code> or <code class="language-plaintext highlighter-rouge">factory.XXX.YYY</code>, where the last variable (<code class="language-plaintext highlighter-rouge">YYY</code>) is the property to set and everything in between is the getter of the class to use to set (<code class="language-plaintext highlighter-rouge">YYY</code>). For example:</p>

<ol>
  <li>To set the value for asyncSend in ActiveMQConnectionFactory, use:
    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>factory.useAsyncSend=true
</code></pre></div>    </div>
    <p>which is equivalent to calling</p>
    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>factory.setUseAsyncSend(true)
</code></pre></div>    </div>
  </li>
  <li>To set the queue prefetch for ActiveMQConnectionFactory, use:
    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>factory.prefetchPolicy.queuePrefetch=1
</code></pre></div>    </div>
    <p>which is equivalent to calling</p>
    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>factory.getPrefetchPolicy().setQueuePrefetch(1)
</code></pre></div>    </div>
  </li>
</ol>

<p>It should be noted that the loaded class should implement the appropriate getter and setter methods. Nested objects should also be properly instantiated. For more information on configuring this SPI, refer to the specific provider API manual.</p>

<p>As of ActiveMQ Classic 4.0.1, these are the available fields and default values:</p>

<table>
  <thead>
    <tr>
      <th>Configuration Key</th>
      <th>Default Value</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">factory.prefetchPolicy.optimizeDurableTopicPrefetch</code></td>
      <td>1000</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">factory.prefetchPolicy.durableTopicPrefetch</code></td>
      <td>100</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">factory.password</code></td>
      <td>null</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">factory.prefetchPolicy.queueBrowserPrefetch</code></td>
      <td>500</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">factory.useCompression</code></td>
      <td>false</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">factory.disableTimeStampsByDefault</code></td>
      <td>false</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">factory.optimizedMessageDispatch</code></td>
      <td>true</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">factory.useRetroactiveConsumer</code></td>
      <td>false</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">factory.alwaysSessionAsync</code></td>
      <td>true</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">factory.copyMessageOnSend</code></td>
      <td>true</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">factory.prefetchPolicy.topicPrefetch</code></td>
      <td>32766</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">factory.useAsyncSend</code></td>
      <td>false</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">factory.redeliveryPolicy.backOffMultiplier</code></td>
      <td>5</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">factory.prefetchPolicy.inputStreamPrefetch</code></td>
      <td>100</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">factory.closeTimeout</code></td>
      <td>15000</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">factory.userName</code></td>
      <td>null</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">factory.optimizeAcknowledge</code></td>
      <td>false</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">factory.clientID</code></td>
      <td>null</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">factory.objectMessageSerializationDefered</code></td>
      <td>false</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">factory.asyncDispatch</code></td>
      <td>false</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">factory.redeliveryPolicy.initialRedeliveryDelay</code></td>
      <td>1000</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">factory.prefetchPolicy.queuePrefetch</code></td>
      <td>1000</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">factory.redeliveryPolicy.maximumRedeliveries</code></td>
      <td>5</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">factory.redeliveryPolicy.useCollisionAvoidance</code></td>
      <td>false</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">factory.prefetchPolicy.maximumPendingMessageLimit</code></td>
      <td>0</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">factory.redeliveryPolicy.useExponentialBackOff</code></td>
      <td>false</td>
    </tr>
  </tbody>
</table>

<h3 id="configuration-for-samplers">Configuration for samplers</h3>

<p>There are two samplers built into the perfomance test tool. Both are configured with the same configuration keys, only prefixed with different sampler names.</p>

<table>
  <tbody>
    <tr>
      <td>Sampler</td>
      <td><em>samplerName</em></td>
    </tr>
    <tr>
      <td>Throughput Sampler</td>
      <td>tpSampler</td>
    </tr>
    <tr>
      <td>CPU Sampler</td>
      <td>cpuSampler</td>
    </tr>
  </tbody>
</table>

<p>For example, it is possible to configure the two samplers differently for a single test run, using the prefixes above as follows:</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>mvn activemq-perf:producer -DtpSampler.duration=10000 -DcpuSampler.duration=15000
</code></pre></div></div>
<p>By default, both samplers are used within a test run. This however, can be overridden through the use of the <code class="language-plaintext highlighter-rouge">sysTest.samplers</code> property.</p>

<h4 id="before-activemq-classic-511">Before ActiveMQ Classic 5.11</h4>

<p>Sampler configurations are not tied in to the test run, so it is possible for the sampler to run for longer than the actual test itself. For short run durations, the sampler may not even have ramped up before the test completes.</p>

<table>
  <thead>
    <tr>
      <th>Configuration Key</th>
      <th>Default Value</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">&lt;samplerName&gt;.duration</code></td>
      <td>300000</td>
      <td>The total duration (in ms) the sampler will run, including ramp up and ramp down time.</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">&lt;samplerName&gt;.rampUpTime</code></td>
      <td>30000</td>
      <td>The ramp up time of the sampler, sampling will only start after the ramp up time.</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">&lt;samplerName&gt;.rampDownTime</code></td>
      <td>30000</td>
      <td>The ramp down time of the sampler, sampling will stop when the sampler has executed for (duration - rampUpTime - rampDownTime) ms.</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">&lt;samplerName&gt;.interval</code></td>
      <td>1000</td>
      <td>The interval (in ms), the sampler will sample for data.</td>
    </tr>
  </tbody>
</table>

<h4 id="from-activemq-classic-511">From ActiveMQ Classic 5.11</h4>

<p>Sampler run duration is tied directly to the behavior of the client (producer/consumer). Due to the non-deterministic nature of count-based tests (where consumer.recvType or producer.sendType are set to <code class="language-plaintext highlighter-rouge">count</code>), duration, ramp up and ramp down times are ignored; the samplers are shut down when the client completes.</p>

<table>
  <thead>
    <tr>
      <th>Configuration Key</th>
      <th>Default Value</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">&lt;samplerName&gt;.duration</code></td>
      <td>For time-based tests, matches the consumer or producer duration. <em>Ignored for count-based tests.</em></td>
      <td>The total duration (in ms) the sampler will run, including ramp up and ramp down time.</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">&lt;samplerName&gt;.rampUpTime</code></td>
      <td>null; defers to rampUpPercent. <em>Ignored for count-based tests.</em></td>
      <td>The ramp up time of the sampler, sampling will only start after the ramp up time.</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">&lt;samplerName&gt;.rampDownTime</code></td>
      <td>null; defers to rampDownPercent. <em>Ignored for count-based tests.</em></td>
      <td>The ramp down time of the sampler, sampling will stop when the sampler has executed for (duration - rampUpTime - rampDownTime) ms.</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">&lt;samplerName&gt;.rampUpPercent</code></td>
      <td>0 <em>Ignored for count-based tests.</em></td>
      <td>The percentage of the overall run duration that the sampler should use to ramp up (0-100). Overridden by rampUpTime.</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">&lt;samplerName&gt;.rampDownPercent</code></td>
      <td>0 <em>Ignored for count-based tests.</em></td>
      <td>The percentage of the overall run duration that the sampler should use to ramp down (0-99). Overridden by rampDownTime.</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">&lt;samplerName&gt;.interval</code></td>
      <td>1000</td>
      <td>The interval (in ms), the sampler will sample for data.</td>
    </tr>
  </tbody>
</table>

<p>The time taken to ramp up and ramp down, whether defined through milliseconds or as a percentage cannot exceed the total duration.</p>

      </div>
    </div>
  </div>
</div>
<div class="row sitemap">
  <div class="col-sm-12">
    <div class="container">
      <div class="row">
        <div class="col-sm-12">
          <div class="row">
            <div class="col-sm-3">
              <div >
                <img class="float-left" style="max-height: 100px" src="/assets/img/activemq_logo_white_vertical_small.png"/>
              </div>
            </div>
            <div style="text-align: center; margin-bottom: 0px; margin-top: 30px; font-size: 65%" class="col-sm-6">
              <p><a href="https://www.apache.org/foundation/marks/list/">Apache, ActiveMQ, Apache ActiveMQ</a>, the Apache feather logo, and the Apache ActiveMQ project logo are trademarks of The Apache Software Foundation. Copyright &copy; 2025, The Apache Software Foundation. Licensed under <a href="http://www.apache.org/licenses/LICENSE-2.0">Apache License 2.0</a>.</p>
            </div>
            <div class="col-sm-3">
              <div >
                <a href="https://www.apache.org"><img class="float-right" style="margin-top: 10px; max-height: 80px" src="/assets/img/apache-logo-small.png"/></a>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

</body>
</html>

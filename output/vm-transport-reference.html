<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>ActiveMQ</title>
    <link rel="icon" type="image/png" href="/assets/img/favicon.png">

    <link rel="stylesheet" href="/css/main.css">
    <script defer src="https://use.fontawesome.com/releases/v5.0.8/js/all.js" integrity="sha384-SlE991lGASHoBfWbelyBPLsUlwY1GwNDJo3jSJO04KZ33K2bwfV9YBauFfnzvynJ" crossorigin="anonymous"></script>
    <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>
</head>

<body>
<nav class="navbar navbar-expand-lg navbar-light fixed-top">
    <div class="container">
        <!-- <a class="navbar-brand mr-auto" href="#"><img style="height: 50px" src="assets/img/apache-feather.png" /></a> -->
        <a class="navbar-brand mr-auto" href="/"><img src="/assets/img/activemq_logo_black_small.png" style="height: 50px"/></a>
        <button class="navbar-toggler ml-auto" type="button" data-toggle="collapse" data-target="#navbarContent" aria-controls="navbarContent" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>

        <div class="ml-auto collapse navbar-collapse" id="navbarContent">
            <ul class="navbar-nav ml-auto">
                <li class="nav-item">
                    <a class="nav-link active" href="/news">News</a>
                </li>
                <li class="nav-item dropdown">
                    <a class="nav-link" id="navbarDropdownComponents" data-target="#" href="" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Components<span class="caret"></span></a>
                    <ul class="dropdown-menu dropdown-menu-center" aria-labelledby="navbarDropdownComponents">
                        <div class="row">
                            <div class="col-12">
                                <ul class="multi-column-dropdown">
                                    <li class="nav-item"><a class="dropdown-item" href="/components/classic">ActiveMQ "Classic"</a></li>
                                    <li class="nav-item"><a class="dropdown-item" href="/components/artemis/">ActiveMQ Artemis</a></li>
                                    <li class="nav-item"><a class="dropdown-item" href="/components/nms">NMS Clients</a></li>
                                    <li class="nav-item"><a class="dropdown-item" href="/components/cms">CMS Client</a></li>
                                </ul>
                            </div>
                        </div>
                    </ul>
                </li>
                <li class="nav-item dropdown">
                    <a class="nav-link" id="navbarDropdownCommunity" data-target="#" href="" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Community<span class="caret"></span></a>
                    <ul class="dropdown-menu dropdown-menu-center multi-column columns-1" aria-labelledby="navbarDropdownCommunity">
                        <div class="row">
                            <div class="col-12">
                                <ul class="multi-column-dropdown">
                                    <li class="nav-item"><a class="dropdown-item" href="/contact">Contact Us</a></li>
                                    <li class="nav-item"><a class="dropdown-item" href="/contributing">Contribute</a></li>
                                    <li class="nav-item"><a class="dropdown-item" href="/issues">Report Issues</a></li>
                                    <li class="nav-item"><a class="dropdown-item" href="/support">Get Support</a></li>
                                </ul>
                            </div>
                          </div>
                    </ul>
                </li>
                <li class="nav-item dropdown">
                    <a class="nav-link" id="navbarDropdownTeam" data-target="#" href="" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"><img src="/assets/img/feather.png" style="height:20px">Apache<span class="caret"></span></a>
                    <ul class="dropdown-menu dropdown-menu-center multi-column columns-1" aria-labelledby="navbarDropdownTeam">
                        <div class="row">
                            <div class="col-sm-12">
                                <ul class="multi-column-dropdown">
                                    <li class="nav-item"><a class="dropdown-item" href="https://www.apache.org">The Apache Software Foundation</a></li>
                                    <li class="nav-item"><a class="dropdown-item" href="https://www.apache.org/licenses/">License</a></li>
                                    <li class="nav-item"><a class="dropdown-item" href="https://www.apache.org/foundation/sponsorship.html">Sponsorship</a></li>
                                    <li class="nav-item"><a class="dropdown-item" href="https://www.apache.org/foundation/thanks.html">Thanks</a></li>
                                    <li class="nav-item"><a class="dropdown-item" href="/security-advisories">Security</a></li>
                                    <li class="nav-item"><a class="dropdown-item" href="https://www.apache.org/events/current-event">Events</a></li>
                                    <li class="nav-item"><a class="dropdown-item" href="https://people.apache.org/phonebook.html?pmc=activemq">PMC & Committers</a></li>
                                    <li class="nav-item"><a class="dropdown-item" href="/team/reports">Board Reports</a></li>
                                </ul>
                            </div>
                        </div>
                    </ul>
                </li>
            </ul>
        </div>
    </div>
</nav>

<div class="content">
  <div class="page-title-activemq5">
    <div class="container">
      <h1>VM Transport Reference</h1>
    </div>
  </div>
  <div class="container" >
    <div class="row" style="margin-top: 30px">
      <div class="col-12 activemq5">
        <p><a href="using-activemq">Using ActiveMQ</a> &gt; <a href="configuring-transports">Configuring Transports</a> &gt; <a href="activemq-connection-uris">ActiveMQ Connection URIs</a> &gt; <a href="vm-transport-reference">VM Transport Reference</a></p>

<h3 id="the-vm-transport">The VM Transport</h3>

<p>The VM transport allows clients to connect to each other inside the VM without the overhead of the network communication. The connection used is not a socket connection but use direct method invocations which enables a high performance embedded messaging system.</p>

<p>The first client to use the VM connection will boot an embedded broker. Subsequent connections will attach that the same broker. Once all VM connections to the broker have been closed, the embedded broker will automatically shutdown.</p>

<h4 id="simple-broker-configuration-syntax">Simple Broker Configuration Syntax</h4>

<p>This is the normal syntax for a VM connection. It’s simple, but provides only a limited amount of configuration of the embedded broker.</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>vm://brokerName?transportOptions
</code></pre></div></div>
<p>If you want to connect to an already instantiated, embedded broker (e.g. as in case the case of Apache ServiceMix), make sure the brokerName used in the <strong>vm://brokerName</strong> url matches the brokerName of the already running broker.</p>

<h5 id="transport-options">Transport Options</h5>

<table>
  <thead>
    <tr>
      <th>Option Name</th>
      <th>Default Value</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>marshal</td>
      <td>false</td>
      <td>If true, forces each command sent over the transport to be marshalled and unmarshalled using a WireFormat</td>
    </tr>
    <tr>
      <td>wireFormat</td>
      <td>default</td>
      <td>The name of the WireFormat to use</td>
    </tr>
    <tr>
      <td>wireFormat.*</td>
      <td> </td>
      <td>All the properties with this prefix are used to configure the wireFormat</td>
    </tr>
    <tr>
      <td>create</td>
      <td>true</td>
      <td>If the broker should be created on demand if it does not already exist.</td>
    </tr>
    <tr>
      <td>waitForStart</td>
      <td>-1</td>
      <td>If &gt; 0, indicates the timeout in milliseconds to wait for a broker to start. Values -1 and 0 mean don’t wait. Only supported in ActiveMQ 5.2+</td>
    </tr>
    <tr>
      <td>broker.*</td>
      <td> </td>
      <td>All the properties with this prefix are used to configure the broker. See <a href="configuring-wire-formats">Configuring Wire Formats</a> for more information</td>
    </tr>
  </tbody>
</table>

<h5 id="example-uri">Example URI</h5>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>vm://broker1?marshal=false&amp;broker.persistent=false
</code></pre></div></div>
<p>Be careful with embedded brokers</p>

<p>If you are using the VM transport and wish to explicitly configure an <a href="how-do-i-embed-a-broker-inside-a-connection">Embedded Broker</a> there is a chance that you could create the JMS connections first before the broker starts up. Currently ActiveMQ will auto-create a broker if you use the VM transport and there is not one already configured. (In 5.2 it is possible to use the waitForStart and create=false options for the connection uri)</p>

<p>So to work around this if you are using Spring you may wish to use the <strong>depends-on</strong> attribute so that your JMS ConnectionFactory depends on the embedded broker to avoid this happening. e.g.</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&lt;bean id="broker" class="org.apache.activemq.xbean.BrokerFactoryBean"&gt;
    &lt;property name="config" value="classpath:org/apache/activemq/xbean/activemq.xml" /&gt;
    &lt;property name="start" value="true" /&gt;
  &lt;/bean&gt;

  &lt;bean id="connectionFactory" class="org.apache.activemq.ActiveMQConnectionFactory" depends-on="broker"&gt;
    &lt;property name="brokerURL" value="vm://localhost"/&gt;
  &lt;/bean&gt;
</code></pre></div></div>

<h4 id="advanced-broker-configuration-syntax">Advanced Broker Configuration Syntax</h4>

<p>This is the advanced syntax for a VM connection. It’s allows you configure the broker more extensively using a <a href="broker-configuration-uri">Broker Configuration URI</a>.</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>vm:(broker:(tcp://localhost)?brokerOptions)?transportOptions
</code></pre></div></div>
<p>or</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>vm:broker:(tcp://localhost)?brokerOptions
</code></pre></div></div>

<h5 id="transport-options-1">Transport Options</h5>

<table>
  <thead>
    <tr>
      <th>Option Name</th>
      <th>Default Value</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>marshal</td>
      <td>false</td>
      <td>If true, forces each command sent over the transport to be marshalled and unmarshalled using a WireFormat</td>
    </tr>
    <tr>
      <td>wireFormat</td>
      <td>default</td>
      <td>The name of the WireFormat to use</td>
    </tr>
    <tr>
      <td>wireFormat.*</td>
      <td> </td>
      <td>All the properties with this prefix are used to configure the wireFormat</td>
    </tr>
  </tbody>
</table>

<p>There are <a href="how-should-i-use-the-vm-transport">more options</a> on optimising the use of the VM transport.</p>

<h5 id="example-uri-1">Example URI</h5>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>vm:(broker:(tcp://localhost:6000)?persistent=false)?marshal=false
</code></pre></div></div>

<h4 id="configuring-an-embedded-broker-using-an-external-config-file">Configuring an Embedded Broker Using an External Config File</h4>

<p> To start an embedded broker using the vm transport and configure it using an external configuration file (i.e. activemq.xml), use the following URI:</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>vm://localhost?brokerConfig=xbean:activemq.xml 
</code></pre></div></div>

      </div>
    </div>
  </div>
</div>
<div class="row sitemap">
  <div class="col-sm-12">
    <div class="container">
      <div class="row">
        <div class="col-sm-12">
          <div class="row">
            <div class="col-sm-3">
              <div >
                <img class="float-left" style="max-height: 100px" src="/assets/img/activemq_logo_white_vertical_small.png"/>
              </div>
            </div>
            <div style="text-align: center; margin-bottom: 0px; margin-top: 30px; font-size: 65%" class="col-sm-6">
              <p><a href="https://www.apache.org/foundation/marks/list/">Apache, ActiveMQ, Apache ActiveMQ</a>, the Apache feather logo, and the Apache ActiveMQ project logo are trademarks of The Apache Software Foundation. Copyright &copy; 2021, The Apache Software Foundation. Licensed under <a href="http://www.apache.org/licenses/LICENSE-2.0">Apache License 2.0</a>.</p>
            </div>
            <div class="col-sm-3">
              <div >
                <a href="https://www.apache.org"><img class="float-right" style="margin-top: 10px; max-height: 80px" src="/assets/img/apache-logo-small.png"/></a>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

</body>
</html>

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>ActiveMQ</title>
    <link rel="icon" type="image/png" href="/assets/img/favicon.png">

    <link rel="stylesheet" href="/css/main.css">
    <script defer src="/js/fontawesome-v5.0.8-all.js" integrity="sha384-SlE991lGASHoBfWbelyBPLsUlwY1GwNDJo3jSJO04KZ33K2bwfV9YBauFfnzvynJ"></script>
    <script src="/js/jquery-3.6.1.slim.min.js" integrity="sha384-MYL22lstpGhSa4+udJSGro5I+VfM13fdJfCbAzP9krCEoK5r2EDFdgTg2+DGXdj+"></script>
    <script src="/js/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q"></script>
    <script src="/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl"></script>
</head>

<body>
<nav class="navbar navbar-expand-lg navbar-light fixed-top">
    <div class="container">
        <!-- <a class="navbar-brand mr-auto" href="#"><img style="height: 50px" src="assets/img/apache-feather.png" /></a> -->
        <a class="navbar-brand mr-auto" href="/"><img src="/assets/img/activemq_logo_black_small.png" style="height: 50px"/></a>
        <button class="navbar-toggler ml-auto" type="button" data-toggle="collapse" data-target="#navbarContent" aria-controls="navbarContent" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>

        <div class="ml-auto collapse navbar-collapse" id="navbarContent">
            <ul class="navbar-nav ml-auto">
                <li class="nav-item">
                    <a class="nav-link active" href="/news">News</a>
                </li>
                <li class="nav-item dropdown">
                    <a class="nav-link" id="navbarDropdownComponents" data-target="#" href="" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Components<span class="caret"></span></a>
                    <ul class="dropdown-menu dropdown-menu-center" aria-labelledby="navbarDropdownComponents">
                        <div class="row">
                            <div class="col-12">
                                <ul class="multi-column-dropdown">
                                    <li class="nav-item"><a class="dropdown-item" href="/components/classic">ActiveMQ "Classic"</a></li>
                                    <li class="nav-item"><a class="dropdown-item" href="/components/artemis/">ActiveMQ Artemis</a></li>
                                    <li class="nav-item"><a class="dropdown-item" href="/components/nms">NMS Clients</a></li>
                                    <li class="nav-item"><a class="dropdown-item" href="/components/cms">CMS Client</a></li>
                                </ul>
                            </div>
                        </div>
                    </ul>
                </li>
                <li class="nav-item dropdown">
                    <a class="nav-link" id="navbarDropdownCommunity" data-target="#" href="" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Community<span class="caret"></span></a>
                    <ul class="dropdown-menu dropdown-menu-center multi-column columns-1" aria-labelledby="navbarDropdownCommunity">
                        <div class="row">
                            <div class="col-12">
                                <ul class="multi-column-dropdown">
                                    <li class="nav-item"><a class="dropdown-item" href="/contact">Contact Us</a></li>
                                    <li class="nav-item"><a class="dropdown-item" href="/contributing">Contribute</a></li>
                                    <li class="nav-item"><a class="dropdown-item" href="/issues">Report Issues</a></li>
                                    <li class="nav-item"><a class="dropdown-item" href="/support">Get Support</a></li>
                                </ul>
                            </div>
                          </div>
                    </ul>
                </li>
                <li class="nav-item dropdown">
                    <a class="nav-link" id="navbarDropdownTeam" data-target="#" href="" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"><img src="/assets/img/feather.png" style="height:20px">Apache<span class="caret"></span></a>
                    <ul class="dropdown-menu dropdown-menu-center multi-column columns-1" aria-labelledby="navbarDropdownTeam">
                        <div class="row">
                            <div class="col-sm-12">
                                <ul class="multi-column-dropdown">
                                    <li class="nav-item"><a class="dropdown-item" href="https://www.apache.org">The Apache Software Foundation</a></li>
                                    <li class="nav-item"><a class="dropdown-item" href="https://www.apache.org/licenses/">License</a></li>
                                    <li class="nav-item"><a class="dropdown-item" href="https://www.apache.org/foundation/sponsorship.html">Sponsorship</a></li>
                                    <li class="nav-item"><a class="dropdown-item" href="https://www.apache.org/foundation/thanks.html">Thanks</a></li>
                                    <li class="nav-item"><a class="dropdown-item" href="/security-advisories">Security</a></li>
                                    <li class="nav-item"><a class="dropdown-item" href="https://www.apache.org/events/current-event">Events</a></li>
                                    <li class="nav-item"><a class="dropdown-item" href="https://people.apache.org/phonebook.html?pmc=activemq">PMC & Committers</a></li>
                                    <li class="nav-item"><a class="dropdown-item" href="https://whimsy.apache.org/board/minutes/ActiveMQ.html">Board Reports</a></li>
                                    <li class="nav-item"><a class="dropdown-item" href="https://privacy.apache.org/policies/privacy-policy-public.html">Privacy Policy</a></li>
                                </ul>
                            </div>
                        </div>
                    </ul>
                </li>
            </ul>
        </div>
    </div>
</nav>

<div class="content">
  <div class="page-title-activemq5">
    <div class="container">
      <h1>Configurable IOException Handling</h1>
    </div>
  </div>
  <div class="container" >
    <div class="row" style="margin-top: 30px">
      <div class="col-12 activemq5">
        <p><a href="features">Features</a> &gt; <a href="persistence">Persistence</a> &gt; <a href="configurable-ioexception-handling">Configurable IOException Handling</a></p>

<p>Starting with 5.3.1, ActiveMQ provides configurable IOException handling for its file-based message stores. From version 5.5 the handler is also invoked when the JDBC persistence adapter gets a failure on <code class="language-plaintext highlighter-rouge">getConnection()</code>.</p>

<h2 id="default-ioexception-handler">Default IOException handler</h2>

<p>ActiveMQ comes with a default IOException handler, which does the following. When some of the file-based message stores encounter IOException it can be one of the two things: either the disk is unavailable of there’s no more space on the disk.</p>

<p>The first case is usually encountered when disk fails or network disk is disconnected. These errors are not “recoverable” and we usually want to shutdown the broker until problems with the disk are solved.</p>

<p>When there’s no more space on the disk, we usually want to wait that some space is reclaimed and continue what we have been doing before (exchanging messages). All file-based persistent stores are capable of surviving these kind of errors.</p>

<h3 id="configuring-default-ioexception-handler">Configuring Default IOException handler</h3>

<p>There are a couple of properties you can use to tune the behavior of the <code class="language-plaintext highlighter-rouge">DefaultIOExceptionHandler</code>. First, instantiate the exception handler as a bean. Then configure the broker to use the exception handler by setting the broker’s <code class="language-plaintext highlighter-rouge">ioExceptionHandler</code> property.</p>

<p>Example:</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&lt;bean id="ioExceptionHandler" class="org.apache.activemq.util.DefaultIOExceptionHandler"&gt;
  &lt;property name="ignoreAllErrors"&gt;&lt;value&gt;true&lt;/value&gt;&lt;/property&gt;
&lt;/bean&gt;

&lt;broker xmlns="http://activemq.apache.org/schema/core" ioExceptionHandler="#ioExceptionHandler"&gt;
  ...
&lt;/broker&gt;
</code></pre></div></div>
<p>Handler configuration properties:</p>

<table>
  <thead>
    <tr>
      <th>Property</th>
      <th>Since</th>
      <th>Default Value</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">ignoreAllErrors</code></td>
      <td>5.4</td>
      <td><code class="language-plaintext highlighter-rouge">false</code></td>
      <td>When <code class="language-plaintext highlighter-rouge">true</code> all errors are ignored and the broker remains running.</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">ignoreNoSpaceErrors</code></td>
      <td>5.4</td>
      <td><code class="language-plaintext highlighter-rouge">true</code></td>
      <td>When <code class="language-plaintext highlighter-rouge">false</code> ‘no disk space’ errors are treated the same as other errors causing the broker to be stopped.</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">noSpaceMessage</code></td>
      <td>5.4</td>
      <td><code class="language-plaintext highlighter-rouge">space</code></td>
      <td>The string used to match against the exception’s message. When matched a ‘no disk space’ error results.</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">ignoreSQLExceptions</code></td>
      <td>5.5</td>
      <td><code class="language-plaintext highlighter-rouge">true</code></td>
      <td>If <code class="language-plaintext highlighter-rouge">true</code> all SQLExceptions are ignored by the handler allowing them to be handled by the persistence adapter’s locker. When <code class="language-plaintext highlighter-rouge">false</code> the exception handler processes the exception.</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">sqlExceptionMessage</code></td>
      <td>5.5</td>
      <td><code class="language-plaintext highlighter-rouge">""</code></td>
      <td>The SQLException phrase to match when ignoring SQLExceptions. Only matched exceptions are ignored. All SQLExceptions match the default empty string.</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">stopStartConnectors</code></td>
      <td>5.5</td>
      <td><code class="language-plaintext highlighter-rouge">false</code></td>
      <td>When <code class="language-plaintext highlighter-rouge">true</code> transport connectors are stopped (client connections are refused), however, the broker will remain running. The transport connectors will be restarted following a successful persistence adapter checkpoint. All exceptions are ignored whilst the transport connectors are stopped. This option ensures that the broker does not need to be manually restarted in the event of a DB restart, for example.</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">resumeCheckSleepPeriod</code></td>
      <td>5.5</td>
      <td><code class="language-plaintext highlighter-rouge">5sec</code></td>
      <td>The interval between persistence adapter checkpoints. Typically used in conjunction with <code class="language-plaintext highlighter-rouge">stopStartConnectors</code>.</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">systemExitOnShutdown</code></td>
      <td>5.13</td>
      <td><code class="language-plaintext highlighter-rouge">false</code></td>
      <td>before stopping the broker, set the broker attribute systemExitOnShutdown to this value to potentially force a jvm exit.</td>
    </tr>
  </tbody>
</table>

<p>The default configuration will try to find a specified string in the exception message to determine whether it is a ‘no disk space’ error. On most platforms (at least those we have tested), you’ll find the word ‘space’ in it. Of course, you can customize this to your platform by using <code class="language-plaintext highlighter-rouge">noSpaceMessage</code> property.</p>

<p>Note: as of ActiveMQ 5.11 the <code class="language-plaintext highlighter-rouge">JDBCIOExceptionHandler</code> has been deprecated. It has been replaced by the <code class="language-plaintext highlighter-rouge">org.apache.activemq.util.LeaseLockerIOExceptionHandler</code> that will work with any persistence adapter that supports pluggable storage lockers whether or not a locker is in use.</p>

<p>Writing your own handler</p>

<p>In case this handler doesn’t work for you, you can write your own. For example you might want to change the way how you detect full disk and execute some external command, like <code class="language-plaintext highlighter-rouge">df</code> on Linux to be sure.</p>

<p>All you have to do is implement the <code class="language-plaintext highlighter-rouge">org.apache.activemq.util.IOExceptionHandler</code> interface then configure the broker to use it:</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&lt;bean id="ioExceptionHandler" class="com.mycompany.MyIOExceptionHandler"&gt;
  &lt;property name="ignoreAllErrors"&gt;&lt;value&gt;true&lt;/value&gt;&lt;/property&gt;
&lt;/bean&gt;

&lt;broker xmlns="http://activemq.apache.org/schema/core" ioExceptionHandler="#ioExceptionHandler"&gt;
  ...
&lt;/broker&gt;
</code></pre></div></div>

      </div>
    </div>
  </div>
</div>
<div class="row sitemap">
  <div class="col-sm-12">
    <div class="container">
      <div class="row">
        <div class="col-sm-12">
          <div class="row">
            <div class="col-sm-3">
              <div >
                <img class="float-left" style="max-height: 100px" src="/assets/img/activemq_logo_white_vertical_small.png"/>
              </div>
            </div>
            <div style="text-align: center; margin-bottom: 0px; margin-top: 30px; font-size: 65%" class="col-sm-6">
              <p><a href="https://www.apache.org/foundation/marks/list/">Apache, ActiveMQ, Apache ActiveMQ</a>, the Apache feather logo, and the Apache ActiveMQ project logo are trademarks of The Apache Software Foundation. Copyright &copy; 2023, The Apache Software Foundation. Licensed under <a href="http://www.apache.org/licenses/LICENSE-2.0">Apache License 2.0</a>.</p>
            </div>
            <div class="col-sm-3">
              <div >
                <a href="https://www.apache.org"><img class="float-right" style="margin-top: 10px; max-height: 80px" src="/assets/img/apache-logo-small.png"/></a>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

</body>
</html>

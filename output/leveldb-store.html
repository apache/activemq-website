<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>ActiveMQ</title>
    <link rel="icon" type="image/png" href="/assets/img/favicon.png">

    <link rel="stylesheet" href="/css/main.css">
    <script defer src="https://use.fontawesome.com/releases/v5.0.8/js/all.js" integrity="sha384-SlE991lGASHoBfWbelyBPLsUlwY1GwNDJo3jSJO04KZ33K2bwfV9YBauFfnzvynJ" crossorigin="anonymous"></script>
    <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>
</head>

<body>
<nav class="navbar navbar-expand-lg navbar-light fixed-top">
    <div class="container">
        <!-- <a class="navbar-brand mr-auto" href="#"><img style="height: 50px" src="assets/img/apache-feather.png" /></a> -->
        <a class="navbar-brand mr-auto" href="/"><img src="/assets/img/activemq_logo_black_small.png" style="height: 50px"/></a>
        <button class="navbar-toggler ml-auto" type="button" data-toggle="collapse" data-target="#navbarContent" aria-controls="navbarContent" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>

        <div class="ml-auto collapse navbar-collapse" id="navbarContent">
            <ul class="navbar-nav ml-auto">
                <li class="nav-item">
                    <a class="nav-link active" href="/">Home</a>
                </li>
                <li class="nav-item dropdown">
                    <a class="nav-link" id="navbarDropdownComponents" data-target="#" href="" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Components<span class="caret"></span></a>
                    <ul class="dropdown-menu dropdown-menu-center" aria-labelledby="navbarDropdownComponents">
                        <div class="row">
                            <div class="col-12">
                                <ul class="multi-column-dropdown">
                                    <li class="nav-item"><a class="dropdown-item" href="/components/classic">ActiveMQ "Classic"</a></li>
                                    <li class="nav-item"><a class="dropdown-item" href="/components/artemis/">ActiveMQ Artemis</a></li>
                                    <li class="nav-item"><a class="dropdown-item" href="/components/nms">NMS Clients</a></li>
                                    <li class="nav-item"><a class="dropdown-item" href="/components/cms">CMS Client</a></li>
                                </ul>
                            </div>
                        </div>
                    </ul>
                </li>
                <li class="nav-item dropdown">
                    <a class="nav-link" id="navbarDropdownCommunity" data-target="#" href="" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Community<span class="caret"></span></a>
                    <ul class="dropdown-menu dropdown-menu-center multi-column columns-1" aria-labelledby="navbarDropdownCommunity">
                        <div class="row">
                            <div class="col-12">
                                <ul class="multi-column-dropdown">
                                    <li class="nav-item"><a class="dropdown-item" href="/contact">Contact Us</a></li>
                                    <li class="nav-item"><a class="dropdown-item" href="/contributing">Contribute</a></li>
                                    <li class="nav-item"><a class="dropdown-item" href="/issues">Report Issues</a></li>
                                    <li class="nav-item"><a class="dropdown-item" href="/support">Get Support</a></li>
                                </ul>
                            </div>
                          </div>
                    </ul>
                </li>
                <li class="nav-item dropdown">
                    <a class="nav-link" id="navbarDropdownTeam" data-target="#" href="" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"><img src="/assets/img/feather.png" style="height:20px">Apache<span class="caret"></span></a>
                    <ul class="dropdown-menu dropdown-menu-center multi-column columns-1" aria-labelledby="navbarDropdownTeam">
                        <div class="row">
                            <div class="col-sm-12">
                                <ul class="multi-column-dropdown">
                                    <li class="nav-item"><a class="dropdown-item" href="https://www.apache.org">The Apache Software Foundation</a></li>
                                    <li class="nav-item"><a class="dropdown-item" href="https://www.apache.org/licenses/">License</a></li>
                                    <li class="nav-item"><a class="dropdown-item" href="https://www.apache.org/foundation/sponsorship.html">Sponsorship</a></li>
                                    <li class="nav-item"><a class="dropdown-item" href="https://www.apache.org/foundation/thanks.html">Thanks</a></li>
                                    <li class="nav-item"><a class="dropdown-item" href="/security-advisories">Security</a></li>
                                    <li class="nav-item"><a class="dropdown-item" href="https://www.apache.org/events/current-event">Events</a></li>
                                    <li class="nav-item"><a class="dropdown-item" href="https://people.apache.org/phonebook.html?pmc=activemq">PMC & Committers</a></li>
                                    <li class="nav-item"><a class="dropdown-item" href="/team/reports">Board Reports</a></li>
                                </ul>
                            </div>
                        </div>
                    </ul>
                </li>
            </ul>
        </div>
    </div>
</nav>

<div class="content">
  <div class="page-title-activemq5">
    <div class="container">
      <h1>LevelDB Store</h1>
    </div>
  </div>
  <div class="container" >
    <div class="row" style="margin-top: 30px">
      <div class="col-12 activemq5">
        <blockquote>
  <p><strong>Warning</strong></p>

  <p>The LevelDB store has been removed from production.
This page only serves as an archival page for previous releases.
Use <a href="kahadb">KahaDB</a> instead.</p>
</blockquote>

<blockquote>
  <p><strong>Version Compatibility</strong></p>

  <p>Available in ActiveMQ 5.8.0 but became unsupported as of 5.14.2, and was removed in 5.17.0</p>
</blockquote>

<p>The LevelDB Store is a file based persistence database that is local to the message broker that is using it. It has been optimized to provide even faster persistence than KahaDB. It’s similar to KahahDB but instead of using a custom B-Tree implementation to index the write ahead logs, it uses <a href="https://code.google.com/p/leveldb/">LevelDB</a> based indexes which have several nice properties due to the ‘append only’ files access patterns :</p>

<ul>
  <li>Fast updates (No need to do random disk updates)</li>
  <li>Concurrent reads</li>
  <li>Fast index snapshots using hard links</li>
</ul>

<p>Both KahaDB and the LevelDB store have to do periodic garbage collection cycles to determine which log files can deleted. In the case of KahaDB, this can be quite expensive as you increase the amount of data stored and can cause read/write stalls while the collection occurs. The LevelDB store uses a much cheaper algorithm to determine when log files can be collected and avoids those stalls.</p>

<h2 id="configuration">Configuration</h2>

<p>You can configure ActiveMQ to use LevelDB for its persistence adapter - like below :</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  &lt;broker brokerName="broker" ... &gt;
    ...
    &lt;persistenceAdapter&gt;
      &lt;levelDB directory="activemq-data"/&gt;
    &lt;/persistenceAdapter&gt;
    ...
  &lt;/broker&gt;
</code></pre></div></div>
<h3 id="leveldb-properties">LevelDB Properties</h3>

<table>
  <thead>
    <tr>
      <th>property name</th>
      <th>default value</th>
      <th>Comments</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">directory</code></td>
      <td><code class="language-plaintext highlighter-rouge">LevelDB</code></td>
      <td>The directory which the store will use to hold it’s data files. The store will create the directory if it does not already exist.</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">sync</code></td>
      <td><code class="language-plaintext highlighter-rouge">true</code></td>
      <td>If set to false, then the store does not sync logging operations to disk</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">logSize</code></td>
      <td><code class="language-plaintext highlighter-rouge">104857600</code> (100 MB)</td>
      <td>The max size (in bytes) of each data log file before log file rotation occurs.</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">verifyChecksums</code></td>
      <td><code class="language-plaintext highlighter-rouge">false</code></td>
      <td>Set to true to force checksum verification of all data that is read from the file system.</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">paranoidChecks</code></td>
      <td><code class="language-plaintext highlighter-rouge">false</code></td>
      <td>Make the store error out as soon as possible if it detects internal corruption.</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">indexFactory</code></td>
      <td><code class="language-plaintext highlighter-rouge">org.fusesource.leveldbjni.JniDBFactory</code>, <code class="language-plaintext highlighter-rouge">org.iq80.leveldb.impl.Iq80DBFactory</code></td>
      <td>The factory classes to use when creating the LevelDB indexes</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">indexMaxOpenFiles</code></td>
      <td>`1000</td>
      <td>Number of open files that can be used by the index.</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">indexBlockRestartInterval</code></td>
      <td>16</td>
      <td>Number keys between restart points for delta encoding of keys.</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">indexWriteBufferSize</code></td>
      <td><code class="language-plaintext highlighter-rouge">6291456</code> (6 MB)</td>
      <td>Amount of index data to build up in memory before converting to a sorted on-disk file.</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">indexBlockSize</code></td>
      <td><code class="language-plaintext highlighter-rouge">4096</code> (4 K)</td>
      <td>The size of index data packed per block.</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">indexCacheSize</code></td>
      <td><code class="language-plaintext highlighter-rouge">268435456</code> (256 MB)</td>
      <td>The maximum amount of off-heap memory to use to cache index blocks.</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">indexCompression</code></td>
      <td><code class="language-plaintext highlighter-rouge">snappy</code></td>
      <td>The type of compression to apply to the index blocks. Can be snappy or none.</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">logCompression</code></td>
      <td><code class="language-plaintext highlighter-rouge">none</code></td>
      <td>The type of compression to apply to the log records. Can be snappy or none.</td>
    </tr>
  </tbody>
</table>

<p>For tuning locking properties please take a look at <a href="pluggable-storage-lockers">Pluggable storage lockers</a></p>

<h2 id="also-see">Also See</h2>

<ul>
  <li><a href="replicated-leveldb-store">Replicated LevelDB Store</a> An extended version of this store which self replicates to other broker nodes to increase message availability.</li>
</ul>


      </div>
    </div>
  </div>
</div>
<div class="row sitemap">
  <div class="col-sm-12">
    <div class="container">
      <div class="row">
        <div class="col-sm-12">
          <div class="row">
            <div class="col-sm-3">
              <div >
                <img class="float-left" style="max-height: 100px" src="/assets/img/activemq_logo_white_vertical_small.png"/>
              </div>
            </div>
            <div style="text-align: center; margin-bottom: 0px; margin-top: 30px; font-size: 65%" class="col-sm-6">
              <p><a href="https://www.apache.org/foundation/marks/list/">Apache, ActiveMQ, Apache ActiveMQ</a>, the Apache feather logo, and the Apache ActiveMQ project logo are trademarks of The Apache Software Foundation. Copyright &copy; 2021, The Apache Software Foundation. Licensed under <a href="http://www.apache.org/licenses/LICENSE-2.0">Apache License 2.0</a>.</p>
            </div>
            <div class="col-sm-3">
              <div >
                <a href="https://www.apache.org"><img class="float-right" style="margin-top: 10px; max-height: 80px" src="/assets/img/apache-logo-small.png"/></a>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

</body>
</html>

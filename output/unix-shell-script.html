<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>ActiveMQ</title>
    <link rel="icon" type="image/png" href="/assets/img/favicon.png">

    <link rel="stylesheet" href="/css/main.css">
    <script defer src="/js/fontawesome-v5.0.8-all.js" integrity="sha384-SlE991lGASHoBfWbelyBPLsUlwY1GwNDJo3jSJO04KZ33K2bwfV9YBauFfnzvynJ"></script>
    <script src="/js/jquery-3.6.1.slim.min.js" integrity="sha384-MYL22lstpGhSa4+udJSGro5I+VfM13fdJfCbAzP9krCEoK5r2EDFdgTg2+DGXdj+"></script>
    <script src="/js/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q"></script>
    <script src="/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl"></script>
</head>

<body>
<nav class="navbar navbar-expand-lg navbar-light fixed-top">
    <div class="container">
        <!-- <a class="navbar-brand mr-auto" href="#"><img style="height: 50px" src="assets/img/apache-feather.png" /></a> -->
        <a class="navbar-brand mr-auto" href="/"><img src="/assets/img/activemq_logo_black_small.png" style="height: 50px"/></a>
        <button class="navbar-toggler ml-auto" type="button" data-toggle="collapse" data-target="#navbarContent" aria-controls="navbarContent" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>

        <div class="ml-auto collapse navbar-collapse" id="navbarContent">
            <ul class="navbar-nav ml-auto">
                <li class="nav-item">
                    <a class="nav-link active" href="/news">News</a>
                </li>
                <li class="nav-item dropdown">
                    <a class="nav-link" id="navbarDropdownComponents" data-target="#" href="" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Components<span class="caret"></span></a>
                    <ul class="dropdown-menu dropdown-menu-center" aria-labelledby="navbarDropdownComponents">
                        <div class="row">
                            <div class="col-12">
                                <ul class="multi-column-dropdown">
                                    <li class="nav-item"><a class="dropdown-item" href="/components/classic">ActiveMQ "Classic"</a></li>
                                    <li class="nav-item"><a class="dropdown-item" href="/components/artemis/">ActiveMQ Artemis</a></li>
                                    <li class="nav-item"><a class="dropdown-item" href="/components/nms">NMS Clients</a></li>
                                    <li class="nav-item"><a class="dropdown-item" href="/components/cms">CMS Client</a></li>
                                </ul>
                            </div>
                        </div>
                    </ul>
                </li>
                <li class="nav-item dropdown">
                    <a class="nav-link" id="navbarDropdownCommunity" data-target="#" href="" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Community<span class="caret"></span></a>
                    <ul class="dropdown-menu dropdown-menu-center multi-column columns-1" aria-labelledby="navbarDropdownCommunity">
                        <div class="row">
                            <div class="col-12">
                                <ul class="multi-column-dropdown">
                                    <li class="nav-item"><a class="dropdown-item" href="/contact">Contact Us</a></li>
                                    <li class="nav-item"><a class="dropdown-item" href="/contributing">Contribute</a></li>
                                    <li class="nav-item"><a class="dropdown-item" href="/issues">Report Issues</a></li>
                                    <li class="nav-item"><a class="dropdown-item" href="/support">Get Support</a></li>
                                </ul>
                            </div>
                          </div>
                    </ul>
                </li>
                <li class="nav-item dropdown">
                    <a class="nav-link" id="navbarDropdownTeam" data-target="#" href="" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"><img src="/assets/img/feather.png" style="height:20px">Apache<span class="caret"></span></a>
                    <ul class="dropdown-menu dropdown-menu-center multi-column columns-1" aria-labelledby="navbarDropdownTeam">
                        <div class="row">
                            <div class="col-sm-12">
                                <ul class="multi-column-dropdown">
                                    <li class="nav-item"><a class="dropdown-item" href="https://www.apache.org">The Apache Software Foundation</a></li>
                                    <li class="nav-item"><a class="dropdown-item" href="https://www.apache.org/licenses/">License</a></li>
                                    <li class="nav-item"><a class="dropdown-item" href="https://www.apache.org/foundation/sponsorship.html">Sponsorship</a></li>
                                    <li class="nav-item"><a class="dropdown-item" href="https://www.apache.org/foundation/thanks.html">Thanks</a></li>
                                    <li class="nav-item"><a class="dropdown-item" href="/security-advisories">Security</a></li>
                                    <li class="nav-item"><a class="dropdown-item" href="https://www.apache.org/events/current-event">Events</a></li>
                                    <li class="nav-item"><a class="dropdown-item" href="https://people.apache.org/phonebook.html?pmc=activemq">PMC & Committers</a></li>
                                    <li class="nav-item"><a class="dropdown-item" href="https://whimsy.apache.org/board/minutes/ActiveMQ.html">Board Reports</a></li>
                                    <li class="nav-item"><a class="dropdown-item" href="https://privacy.apache.org/policies/privacy-policy-public.html">Privacy Policy</a></li>
                                </ul>
                            </div>
                        </div>
                    </ul>
                </li>
            </ul>
        </div>
    </div>
</nav>

<div class="content">
  <div class="page-title-activemq5">
    <div class="container">
      <h1>Unix Shell Script</h1>
    </div>
  </div>
  <div class="container" >
    <div class="row" style="margin-top: 30px">
      <div class="col-12 activemq5">
        <p><a href="features">Features</a> &gt; <a href="unix">Unix</a> &gt; <a href="unix-shell-script">Unix Shell Script</a></p>

<h1 id="functional-overview">Functional overview</h1>

<p>From version 5.4.0 onwards, ActiveMQ comes with a enhanced shell script for starting, stopping and managing the broker in Unix environment. For basic <a href="activemq-command-line-tools-reference">activemq</a> and <a href="activemq-command-line-tools-reference">activemq-admin</a> scripts functionality take a look at <a href="activemq-command-line-tools-reference">ActiveMQ Command Line Tools Reference</a>.</p>

<p>This <code class="language-plaintext highlighter-rouge">activemq</code> script incorporate these two scripts into one and adds some new functionalities. On top of regular <code class="language-plaintext highlighter-rouge">activemq</code> and <code class="language-plaintext highlighter-rouge">activemq-admin</code> scripts, it adds the following features:</p>

<ul>
  <li><strong>start</strong> - starts the broker in background. It saves process id in the <code class="language-plaintext highlighter-rouge">${ACTIVEMQ_DATA_DIR}/activemq.pid</code> for future reference. It accepts the same command line arguments like the original <code class="language-plaintext highlighter-rouge">activemq</code> script, so you can do something like
    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>bin/activemq start xbean:conf/activemq-stomp.xml
</code></pre></div>    </div>
  </li>
  <li>
    <p><strong>console</strong> - starts the broker in foreground. It is basically the replacement for the old <code class="language-plaintext highlighter-rouge">activemq</code> script<br />
(you can interrupt the )</p>
  </li>
  <li>
    <p><strong>stop</strong> - stops the broker that is running in the background. It tries first to stop the broker using <a href="activemq-command-line-tools-reference">shutdown</a> task. If that task doesn’t return in 30 seconds (configurable), it will kill the process.</p>
  </li>
  <li>
    <p><strong>restart</strong> - stops the running instance (if there’s one) and starts the new one</p>
  </li>
  <li>
    <p><strong>status</strong> - checks if activemq process is running (exitcode: 1 = broker is down, 0 = broker is up)</p>
  </li>
  <li><strong>create</strong> - create an ACTIVEMQ_BASE directory that separates a broker instance from its binaries, i.e., it creates copies of the ActiveMQ configuration files into the command-line specified directory and points to the binaries. You can start the broker with the <code class="language-plaintext highlighter-rouge">/bin</code> scripts in the newly created instance.
    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>bin/activemq create /path/to/brokers/mybroker 
</code></pre></div>    </div>
  </li>
  <li><strong>browse</strong> - Display selected messages in a specified destination
    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>bin/activemq browse FOO.BAR # use broker connection from configuration
bin/activemq browse --amqurl tcp://localhost:61616 FOO.BAR
</code></pre></div>    </div>
  </li>
  <li>
    <p><strong>bstat</strong> - Performs a predefined query that displays useful statistics regarding the specified broker</p>
  </li>
  <li>
    <p><strong>dstat</strong> - Performs a predefined query that displays useful tabular statistics regarding the specified destination type</p>
  </li>
  <li><strong>decrypt</strong> - Decrypts given text
    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>bin/activemq decrypt --input 'BkiT42A0CZfL1SanJIgxvQ==' --password asdasdasdasd
</code></pre></div>    </div>
  </li>
  <li><strong>encrypt</strong> - Encrypts given text
    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>bin/activemq encrypt --password TESTPASSWORD --input FOOBAR
</code></pre></div>    </div>
  </li>
  <li><strong>export</strong> - Exports a stopped brokers data files to an archive file for importing to another brokers like ActiveMQ Artemis
    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ bin/activemq export --file=archivefile
</code></pre></div>    </div>
  </li>
  <li>
    <p><strong>list</strong> - Lists all available brokers in the specified JMX context</p>
  </li>
  <li><strong>purge</strong> - Delete selected destination’s messages that matches the message selector
    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>bin/activemq purge FOO.BAR # use jmx access data from configuration
bin/activemq purge --jmxurl service:jmx:rmi:///jndi/rmi://127.0.0.1:11098/jmxrmi --jmxuser controlRole --jmxpassword abcd1234 FOO.BAR
</code></pre></div>    </div>
  </li>
  <li><strong>query</strong> - Display selected broker component’s attributes and statistics
    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>bin/activemq query # use jmx access data from configuration
bin/activemq query --jmxurl service:jmx:rmi:///jndi/rmi://127.0.0.1:11098/jmxrmi --jmxuser controlRole --jmxpassword abcd1234
</code></pre></div>    </div>
  </li>
</ul>

<h1 id="configuring-the-init-script">Configuring the init-script</h1>

<p>For ActiveMQ server to run properly some basic system variables must be set. These variables define how much memory broker will have, SSL, logging, JAAS options and similar.</p>

<h2 id="version-5110-and-higher">Version 5.11.0 and higher</h2>

<h3 id="configuration-file-of-the-init-script">Configuration file of the init-script</h3>

<p>Since version 5.11.0, all default configuration variables are moved to the new <code class="language-plaintext highlighter-rouge">env</code> script file, so that they can be easily inspected and configured in a easy way.<br />
There are also other configuration locations</p>

<p>The script scans the following locations for configurations in the following order:</p>

<ol>
  <li>/etc/default/activemq</li>
  <li>$HOME/.activemqrc</li>
  <li>$INSTALLDIR/apache-activemq-<version>/bin/env</version></li>
</ol>

<p>The first existing file is read exclusively - all other files are ignored.<br />
Undefined values are discovered in a automated way.</p>

<h3 id="versions-prior-5110">Versions prior 5.11.0</h3>

<p>These parameters were configurable in <code class="language-plaintext highlighter-rouge">activemq</code> script itself.</p>

<p>You could use <code class="language-plaintext highlighter-rouge">setup</code> command to create additional system wide defaults file to configure the broker.<br />
(modify the settings in this file if neccessary - the default entries look a bit garbled due to an accidentally applied bugfix in this release)</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>./activemq setup /etc/default/activemq
</code></pre></div></div>
<p>The configuration of the script can be placed at <code class="language-plaintext highlighter-rouge">/etc/default/activemq</code> or <code class="language-plaintext highlighter-rouge">$HOME/.activemqrc</code>. Note, this is the configuration for the <em>script</em> not for configuring ActiveMQ.</p>

<p>To use addtional configurations for running multiple instances on the same operating system rename or symlink script to a name matching to <code class="language-plaintext highlighter-rouge">activemq-instance-&lt;INSTANCENAME&gt;</code>. This changes the configuration location to <code class="language-plaintext highlighter-rouge">/etc/default/activemq-instance-&lt;INSTANCENAME&gt;</code> and <code class="language-plaintext highlighter-rouge">$HOME/.activemqrc-instance-&lt;INSTANCENAME&gt;</code>. Configuration files in /etc have higher precedence.</p>

<h2 id="running-activemq-as-a-unix-daemon">Running activemq as a unix daemon</h2>

<ul>
  <li>Install activemq broker as “root” to be run as “activemq”
    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>useradd -m activemq -d /srv/activemq
cd /srv/activemq
tar zxvf apache-activemq-&lt;version&gt;-bin.tar.gz$ ln -snf apache-activemq-&lt;version&gt; current
chown -R activemq:users apache-activemq-&lt;version&gt;
</code></pre></div>    </div>
  </li>
  <li>Create a global default configuration and edit the configuration
    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>cp apache-activemq-&lt;version&gt;/bin/env /etc/default/activemq
sed -i '~s/^ACTIVEMQ\_USER=""/ACTIVEMQ\_USER="activemq"/' /etc/default/activemq
vim /etc/default/activemq
chmod 644 /etc/default/activemq
</code></pre></div>    </div>
    <ul>
      <li>Configure the java heap to a size suitable to your system environment and usage</li>
      <li>Consider to move the folders “data”, “tmp” and “conf” out of the installation path</li>
    </ul>
  </li>
  <li>Install the init script
    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ln -snf  /srv/activemq/current/bin/activemq /etc/init.d/activemq
</code></pre></div>    </div>
  </li>
  <li>Activate the init script at system startup<br />
(TODO: uncomplete)
    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code># RHEL
chkconfig --add activemq
chkconfig activemq on
    
# Debian/Ubuntu
update-rc.d defaults activemq
</code></pre></div>    </div>
  </li>
</ul>

<h2 id="running-multiple-instances">Running multiple instances</h2>

<p>To use additional configurations for running multiple instances on the same operating system rename or symlink script to a name matching to <code class="language-plaintext highlighter-rouge">activemq-instance-&lt;INSTANCENAME&gt;</code>.<br />
This changes the configuration location to <code class="language-plaintext highlighter-rouge">/etc/default/activemq-instance-&lt;INSTANCENAME&gt;</code> and <code class="language-plaintext highlighter-rouge">$HOME/.activemqrc-instance-&lt;INSTANCENAME&gt;</code>. Configuration files in /etc have higher precedence.</p>

<p>Example procedure suitable to the procedure “Running activemq as a unix daemon”</p>

<p>`Example**</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>mkdir /srv/activemq/instance1
cp -av /srv/activemq/current/conf/ /srv/activemq/instance1/
mkdir /srv/activemq/instance1/{data,tmp}
ln -snf  /srv/activemq/current/bin/activemq /etc/init.d/activemq-instance-test1
cp /srv/activemq/install/bin/env /etc/default/activemq-instance-instance-test1
</code></pre></div></div>
<p>Modify the configuration variables in /etc/default/activemq-instance-instance-test1</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ACTIVEMQ_HOME="/srv/activemq/current/"
ACTIVEMQ_CONF="/srv/activemq/instance1/conf"
ACTIVEMQ_DATA="/srv/activemq/instance1/data"
ACTIVEMQ_TMP="/srv/activemq/instance1/tmp"
</code></pre></div></div>
<p>Control the instance</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>/etc/init.d/activemq-instance1 start|stop|restart|console|....
</code></pre></div></div>
<blockquote>
  <p><strong>Hint</strong></p>

  <p>If you are using multiple instances you can only add the main instance to the automatic system start using (“update-rc.d” or “chkconfig”) because the LSB Header “Provides” needs to be uniq.</p>
</blockquote>

<h1 id="testing-and-reporting-interoperability-problems-for-unix-platforms">Testing and reporting interoperability problems for unix platforms</h1>

<p>The activemq repo provides a testsuite to validate the proper operation of the unix shell script on different platforms.</p>

<ul>
  <li>Download the testsuite<br />
Alternatively clone the sourcecode repo (<a href="source">Source</a>) and pick the file <code class="language-plaintext highlighter-rouge">assembly/src/test/scripts/init-script-testsuite</code>
    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>cd /tmp
wget -c "https://git-wip-us.apache.org/repos/asf?p=activemq.git;a=blob_plain;f=assembly/src/test/scripts/init-script-testsuite;hb=HEAD"
</code></pre></div>    </div>
  </li>
  <li>Execute the testsuite
    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>cd &lt;Installation Dir of the ActiveMQ Script&gt;
./activemq stop
/tmp/init-script-testsuite 2&gt;&amp;1| tee /tmp/test-suite.log
</code></pre></div>    </div>
  </li>
  <li>Detailed debug information can be provided by the following procedure
    <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>export PS4=' ${BASH_SOURCE}:${LINENO}(${FUNCNAME\[0\]}) '
bash -x ./activemq &lt;argument&gt; 2&gt;&amp;1 |tee /tmp/detailed-debugging.log
</code></pre></div>    </div>
  </li>
  <li>Create a ticket and attach the logfiles to the ticket.</li>
</ul>


      </div>
    </div>
  </div>
</div>
<div class="row sitemap">
  <div class="col-sm-12">
    <div class="container">
      <div class="row">
        <div class="col-sm-12">
          <div class="row">
            <div class="col-sm-3">
              <div >
                <img class="float-left" style="max-height: 100px" src="/assets/img/activemq_logo_white_vertical_small.png"/>
              </div>
            </div>
            <div style="text-align: center; margin-bottom: 0px; margin-top: 30px; font-size: 65%" class="col-sm-6">
              <p><a href="https://www.apache.org/foundation/marks/list/">Apache, ActiveMQ, Apache ActiveMQ</a>, the Apache feather logo, and the Apache ActiveMQ project logo are trademarks of The Apache Software Foundation. Copyright &copy; 2022, The Apache Software Foundation. Licensed under <a href="http://www.apache.org/licenses/LICENSE-2.0">Apache License 2.0</a>.</p>
            </div>
            <div class="col-sm-3">
              <div >
                <a href="https://www.apache.org"><img class="float-right" style="margin-top: 10px; max-height: 80px" src="/assets/img/apache-logo-small.png"/></a>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

</body>
</html>

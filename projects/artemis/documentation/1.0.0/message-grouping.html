<!DOCTYPE HTML>
<html lang="en-US" >
    
    <head>
        
        <meta charset="UTF-8">
        <meta http-equiv="X-UA-Compatible" content="IE=11; IE=10; IE=9; IE=8; IE=7; IE=EDGE" />
        <title>Message Grouping | ActiveMQ Artemis Documentation</title>
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="generator" content="GitBook 1.5.0">
        <meta name="HandheldFriendly" content="true"/>
        <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
        <meta name="apple-mobile-web-app-capable" content="yes">
        <meta name="apple-mobile-web-app-status-bar-style" content="black">
        <link rel="apple-touch-icon-precomposed" sizes="152x152" href="gitbook/images/apple-touch-icon-precomposed-152.png">
        <link rel="shortcut icon" href="gitbook/images/favicon.ico" type="image/x-icon">
        
        
    
    
    <link rel="next" href="./pre-acknowledge.html" />
    
    
    <link rel="prev" href="./last-value-queues.html" />
    

        
    </head>
    <body>
        
        
<link rel="stylesheet" href="gitbook/style.css">


        
    <div class="book" data-level="30" data-basepath="." data-revision="1432117733651">
    

<div class="book-summary">
    <div class="book-search">
        <input type="text" placeholder="Type to search" class="form-control" />
    </div>
    <ul class="summary">
        
    	
    	
    	

        

        
    
        
        <li class="chapter " data-level="0" data-path="index.html">
            
                
                    <a href="./index.html">
                        <i class="fa fa-check"></i>
                        
                         Introduction
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="1" data-path="notice.html">
            
                
                    <a href="./notice.html">
                        <i class="fa fa-check"></i>
                        
                            <b>1.</b>
                        
                         Legal Notice
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="2" data-path="preface.html">
            
                
                    <a href="./preface.html">
                        <i class="fa fa-check"></i>
                        
                            <b>2.</b>
                        
                         Preface
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="3" data-path="project-info.html">
            
                
                    <a href="./project-info.html">
                        <i class="fa fa-check"></i>
                        
                            <b>3.</b>
                        
                         Project Info
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="4" data-path="running-server.html">
            
                
                    <a href="./running-server.html">
                        <i class="fa fa-check"></i>
                        
                            <b>4.</b>
                        
                         Running the Server
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="5" data-path="messaging-concepts.html">
            
                
                    <a href="./messaging-concepts.html">
                        <i class="fa fa-check"></i>
                        
                            <b>5.</b>
                        
                         Messaging Concepts
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="6" data-path="architecture.html">
            
                
                    <a href="./architecture.html">
                        <i class="fa fa-check"></i>
                        
                            <b>6.</b>
                        
                         Architecture
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="7" data-path="using-server.html">
            
                
                    <a href="./using-server.html">
                        <i class="fa fa-check"></i>
                        
                            <b>7.</b>
                        
                         Using the Server
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="8" data-path="using-jms.html">
            
                
                    <a href="./using-jms.html">
                        <i class="fa fa-check"></i>
                        
                            <b>8.</b>
                        
                         Using JMS
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="9" data-path="using-core.html">
            
                
                    <a href="./using-core.html">
                        <i class="fa fa-check"></i>
                        
                            <b>9.</b>
                        
                         Using Core
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="10" data-path="jms-core-mapping.html">
            
                
                    <a href="./jms-core-mapping.html">
                        <i class="fa fa-check"></i>
                        
                            <b>10.</b>
                        
                         Mapping JMS Concepts to the Core API
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="11" data-path="client-classpath.html">
            
                
                    <a href="./client-classpath.html">
                        <i class="fa fa-check"></i>
                        
                            <b>11.</b>
                        
                         The Client Classpath
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="12" data-path="examples.html">
            
                
                    <a href="./examples.html">
                        <i class="fa fa-check"></i>
                        
                            <b>12.</b>
                        
                         Examples
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="13" data-path="wildcard-routing.html">
            
                
                    <a href="./wildcard-routing.html">
                        <i class="fa fa-check"></i>
                        
                            <b>13.</b>
                        
                         Routing Messages With Wild Cards
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="14" data-path="wildcard-syntax.html">
            
                
                    <a href="./wildcard-syntax.html">
                        <i class="fa fa-check"></i>
                        
                            <b>14.</b>
                        
                         Understanding the Apache ActiveMQ Artemis Wildcard Syntax
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="15" data-path="filter-expressions.html">
            
                
                    <a href="./filter-expressions.html">
                        <i class="fa fa-check"></i>
                        
                            <b>15.</b>
                        
                         Filter Expressions
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="16" data-path="persistence.html">
            
                
                    <a href="./persistence.html">
                        <i class="fa fa-check"></i>
                        
                            <b>16.</b>
                        
                         Persistence
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="17" data-path="configuring-transports.html">
            
                
                    <a href="./configuring-transports.html">
                        <i class="fa fa-check"></i>
                        
                            <b>17.</b>
                        
                         Configuring Transports
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="18" data-path="connection-ttl.html">
            
                
                    <a href="./connection-ttl.html">
                        <i class="fa fa-check"></i>
                        
                            <b>18.</b>
                        
                         Detecting Dead Connections
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="19" data-path="slow-consumers.html">
            
                
                    <a href="./slow-consumers.html">
                        <i class="fa fa-check"></i>
                        
                            <b>19.</b>
                        
                         Detecting Slow Consumers
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="20" data-path="transaction-config.html">
            
                
                    <a href="./transaction-config.html">
                        <i class="fa fa-check"></i>
                        
                            <b>20.</b>
                        
                         Resource Manager Configuration
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="21" data-path="flow-control.html">
            
                
                    <a href="./flow-control.html">
                        <i class="fa fa-check"></i>
                        
                            <b>21.</b>
                        
                         Flow Control
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="22" data-path="send-guarantees.html">
            
                
                    <a href="./send-guarantees.html">
                        <i class="fa fa-check"></i>
                        
                            <b>22.</b>
                        
                         Guarantees of sends and commits
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="23" data-path="undelivered-messages.html">
            
                
                    <a href="./undelivered-messages.html">
                        <i class="fa fa-check"></i>
                        
                            <b>23.</b>
                        
                         Message Redelivery and Undelivered Messages
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="24" data-path="message-expiry.html">
            
                
                    <a href="./message-expiry.html">
                        <i class="fa fa-check"></i>
                        
                            <b>24.</b>
                        
                         Message Expiry
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="25" data-path="large-messages.html">
            
                
                    <a href="./large-messages.html">
                        <i class="fa fa-check"></i>
                        
                            <b>25.</b>
                        
                         Large Messages
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="26" data-path="paging.html">
            
                
                    <a href="./paging.html">
                        <i class="fa fa-check"></i>
                        
                            <b>26.</b>
                        
                         Paging
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="27" data-path="queue-attributes.html">
            
                
                    <a href="./queue-attributes.html">
                        <i class="fa fa-check"></i>
                        
                            <b>27.</b>
                        
                         Queue Attributes
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="28" data-path="scheduled-messages.html">
            
                
                    <a href="./scheduled-messages.html">
                        <i class="fa fa-check"></i>
                        
                            <b>28.</b>
                        
                         Scheduled Messages
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="29" data-path="last-value-queues.html">
            
                
                    <a href="./last-value-queues.html">
                        <i class="fa fa-check"></i>
                        
                            <b>29.</b>
                        
                         Last-Value Queues
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter active" data-level="30" data-path="message-grouping.html">
            
                
                    <a href="./message-grouping.html">
                        <i class="fa fa-check"></i>
                        
                            <b>30.</b>
                        
                         Message Grouping
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="31" data-path="pre-acknowledge.html">
            
                
                    <a href="./pre-acknowledge.html">
                        <i class="fa fa-check"></i>
                        
                            <b>31.</b>
                        
                         Extra Acknowledge Modes
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="32" data-path="management.html">
            
                
                    <a href="./management.html">
                        <i class="fa fa-check"></i>
                        
                            <b>32.</b>
                        
                         Management
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="33" data-path="security.html">
            
                
                    <a href="./security.html">
                        <i class="fa fa-check"></i>
                        
                            <b>33.</b>
                        
                         Security
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="34" data-path="resource-limits.html">
            
                
                    <a href="./resource-limits.html">
                        <i class="fa fa-check"></i>
                        
                            <b>34.</b>
                        
                         Resource Limits
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="35" data-path="jms-bridge.html">
            
                
                    <a href="./jms-bridge.html">
                        <i class="fa fa-check"></i>
                        
                            <b>35.</b>
                        
                         The JMS Bridge
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="36" data-path="client-reconnection.html">
            
                
                    <a href="./client-reconnection.html">
                        <i class="fa fa-check"></i>
                        
                            <b>36.</b>
                        
                         Client Reconnection and Session Reattachment
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="37" data-path="diverts.html">
            
                
                    <a href="./diverts.html">
                        <i class="fa fa-check"></i>
                        
                            <b>37.</b>
                        
                         Diverting and Splitting Message Flows
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="38" data-path="core-bridges.html">
            
                
                    <a href="./core-bridges.html">
                        <i class="fa fa-check"></i>
                        
                            <b>38.</b>
                        
                         Core Bridges
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="39" data-path="duplicate-detection.html">
            
                
                    <a href="./duplicate-detection.html">
                        <i class="fa fa-check"></i>
                        
                            <b>39.</b>
                        
                         Duplicate Message Detection
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="40" data-path="clusters.html">
            
                
                    <a href="./clusters.html">
                        <i class="fa fa-check"></i>
                        
                            <b>40.</b>
                        
                         Clusters
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="41" data-path="ha.html">
            
                
                    <a href="./ha.html">
                        <i class="fa fa-check"></i>
                        
                            <b>41.</b>
                        
                         High Availability and Failover
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="42" data-path="graceful-shutdown.html">
            
                
                    <a href="./graceful-shutdown.html">
                        <i class="fa fa-check"></i>
                        
                            <b>42.</b>
                        
                         Graceful Server Shutdown
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="43" data-path="libaio.html">
            
                
                    <a href="./libaio.html">
                        <i class="fa fa-check"></i>
                        
                            <b>43.</b>
                        
                         Libaio Native Libraries
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="44" data-path="thread-pooling.html">
            
                
                    <a href="./thread-pooling.html">
                        <i class="fa fa-check"></i>
                        
                            <b>44.</b>
                        
                         Thread management
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="45" data-path="logging.html">
            
                
                    <a href="./logging.html">
                        <i class="fa fa-check"></i>
                        
                            <b>45.</b>
                        
                         Logging
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="46" data-path="rest.html">
            
                
                    <a href="./rest.html">
                        <i class="fa fa-check"></i>
                        
                            <b>46.</b>
                        
                         REST Interface
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="47" data-path="embedding-activemq.html">
            
                
                    <a href="./embedding-activemq.html">
                        <i class="fa fa-check"></i>
                        
                            <b>47.</b>
                        
                         Embedding Apache ActiveMQ Artemis
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="48" data-path="spring-integration.html">
            
                
                    <a href="./spring-integration.html">
                        <i class="fa fa-check"></i>
                        
                            <b>48.</b>
                        
                         Spring Integration
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="49" data-path="aerogear-integration.html">
            
                
                    <a href="./aerogear-integration.html">
                        <i class="fa fa-check"></i>
                        
                            <b>49.</b>
                        
                         AeroGear Integration
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="50" data-path="vertx-integration.html">
            
                
                    <a href="./vertx-integration.html">
                        <i class="fa fa-check"></i>
                        
                            <b>50.</b>
                        
                         VertX Integration
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="51" data-path="intercepting-operations.html">
            
                
                    <a href="./intercepting-operations.html">
                        <i class="fa fa-check"></i>
                        
                            <b>51.</b>
                        
                         Intercepting Operations
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="52" data-path="interoperability.html">
            
                
                    <a href="./interoperability.html">
                        <i class="fa fa-check"></i>
                        
                            <b>52.</b>
                        
                         Interoperability
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="53" data-path="tools.html">
            
                
                    <a href="./tools.html">
                        <i class="fa fa-check"></i>
                        
                            <b>53.</b>
                        
                         Tools
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="54" data-path="perf-tuning.html">
            
                
                    <a href="./perf-tuning.html">
                        <i class="fa fa-check"></i>
                        
                            <b>54.</b>
                        
                         Performance Tuning
                    </a>
                
            
            
        </li>
    
        
        <li class="chapter " data-level="55" data-path="configuration-index.html">
            
                
                    <a href="./configuration-index.html">
                        <i class="fa fa-check"></i>
                        
                            <b>55.</b>
                        
                         Configuration Reference
                    </a>
                
            
            
        </li>
    


        
        <li class="divider"></li>
        <li>
            <a href="http://www.gitbook.io/" target="blank" class="gitbook-link">Published using GitBook</a>
        </li>
        
    </ul>
</div>

    <div class="book-body">
        <div class="body-inner">
            <div class="book-header">
    <!-- Actions Left -->
    <a href="#" class="btn pull-left toggle-summary" aria-label="Toggle summary"><i class="fa fa-align-justify"></i></a>
    <a href="#" class="btn pull-left toggle-search" aria-label="Toggle search"><i class="fa fa-search"></i></a>
    
    <div id="font-settings-wrapper" class="dropdown pull-left">
        <a href="#" class="btn toggle-dropdown" aria-label="Toggle font settings"><i class="fa fa-font"></i>
        </a>
        <div class="dropdown-menu font-settings">
    <div class="dropdown-caret">
        <span class="caret-outer"></span>
        <span class="caret-inner"></span>
    </div>

    <div class="buttons">
        <button type="button" id="reduce-font-size" class="button size-2">A</button>
        <button type="button" id="enlarge-font-size" class="button size-2">A</button>
    </div>

    <div class="buttons font-family-list">
        <button type="button" data-font="0" class="button">Serif</button>
        <button type="button" data-font="1" class="button">Sans</button>
    </div>

    <div class="buttons color-theme-list">
        <button type="button" id="color-theme-preview-0" class="button size-3" data-theme="0">White</button>
        <button type="button" id="color-theme-preview-1" class="button size-3" data-theme="1">Sepia</button>
        <button type="button" id="color-theme-preview-2" class="button size-3" data-theme="2">Night</button>
    </div>
</div>

    </div>

    <!-- Actions Right -->
    
    <div class="dropdown pull-right">
        <a href="#" class="btn toggle-dropdown" aria-label="Toggle share dropdown"><i class="fa fa-share-alt"></i>
        </a>
        <div class="dropdown-menu font-settings dropdown-left">
            <div class="dropdown-caret">
                <span class="caret-outer"></span>
                <span class="caret-inner"></span>
            </div>
            <div class="buttons">
                <button type="button" data-sharing="twitter" class="button">Twitter</button>
                <button type="button" data-sharing="google-plus" class="button">Google</button>
                <button type="button" data-sharing="facebook" class="button">Facebook</button>
                <button type="button" data-sharing="weibo" class="button">Weibo</button>
                <button type="button" data-sharing="instapaper" class="button">Instapaper</button>
            </div>
        </div>
    </div>
    

    
    <a href="#" target="_blank" class="btn pull-right google-plus-sharing-link sharing-link" data-sharing="google-plus" aria-label="Share on Google Plus"><i class="fa fa-google-plus"></i></a>
    
    
    <a href="#" target="_blank" class="btn pull-right facebook-sharing-link sharing-link" data-sharing="facebook" aria-label="Share on Facebook"><i class="fa fa-facebook"></i></a>
    
    
    <a href="#" target="_blank" class="btn pull-right twitter-sharing-link sharing-link" data-sharing="twitter" aria-label="Share on Twitter"><i class="fa fa-twitter"></i></a>
    
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href="./" >ActiveMQ Artemis Documentation</a>
    </h1>
</div>

            <div class="page-wrapper" tabindex="-1">
                <div class="page-inner">
                
                
                    <section class="normal" id="section-gitbook_30">
                    
                        <h1 id="message-grouping">Message Grouping</h1>
<p>Message groups are sets of messages that have the following
characteristics:</p>
<ul>
<li><p>Messages in a message group share the same group id, i.e. they have
same group identifier property (<code>JMSXGroupID</code> for JMS,
<code>_AMQ_GROUP_ID</code> for Apache ActiveMQ Artemis Core API).</p>
</li>
<li><p>Messages in a message group are always consumed by the same
consumer, even if there are many consumers on a queue. They pin all
messages with the same group id to the same consumer. If that
consumer closes another consumer is chosen and will receive all
messages with the same group id.</p>
</li>
</ul>
<p>Message groups are useful when you want all messages for a certain value
of the property to be processed serially by the same consumer.</p>
<p>An example might be orders for a certain stock. You may want orders for
any particular stock to be processed serially by the same consumer. To
do this you can create a pool of consumers (perhaps one for each stock,
but less will work too), then set the stock name as the value of the
_AMQ_GROUP_ID property.</p>
<p>This will ensure that all messages for a particular stock will always be
processed by the same consumer.</p>
<blockquote>
<p><strong>Note</strong></p>
<p>Grouped messages can impact the concurrent processing of non-grouped
messages due to the underlying FIFO semantics of a queue. For example,
if there is a chunk of 100 grouped messages at the head of a queue
followed by 1,000 non-grouped messages then all the grouped messages
will need to be sent to the appropriate client (which is consuming
those grouped messages serially) before any of the non-grouped
messages can be consumed. The functional impact in this scenario is a
temporary suspension of concurrent message processing while all the
grouped messages are processed. This can be a performance bottleneck
so keep it in mind when determining the size of your message groups,
and consider whether or not you should isolate your grouped messages
from your non-grouped messages.</p>
</blockquote>
<h2 id="using-core-api">Using Core API</h2>
<p>The property name used to identify the message group is <code>&quot;_AMQ_GROUP_ID&quot;</code>
(or the constant <code>MessageImpl.HDR_GROUP_ID</code>). Alternatively, you can set
<code>autogroup</code> to true on the <code>SessionFactory</code> which will pick a random
unique id.</p>
<h2 id="using-jms">Using JMS</h2>
<p>The property name used to identify the message group is <code>JMSXGroupID</code>.</p>
<pre><code> // send 2 messages in the same group to ensure the same
 // consumer will receive both
 Message message = ...
 message.setStringProperty(&quot;JMSXGroupID&quot;, &quot;Group-0&quot;);
 producer.send(message);

 message = ...
 message.setStringProperty(&quot;JMSXGroupID&quot;, &quot;Group-0&quot;);
 producer.send(message);
</code></pre><p>Alternatively, you can set <code>autogroup</code> to true on the
<code>ActiveMQConnectonFactory</code> which will pick a random unique id. This can
also be set in the JNDI context environment, e.g. <code>jndi.properties</code>.
Here&#39;s a simple example using the &quot;ConnectionFactory&quot; connection factory
which is available in the context by default</p>
<pre><code>java.naming.factory.initial=org.apache.activemq.artemis.jndi.ActiveMQInitialContextFactory
connectionFactory.myConnectionFactory=tcp://localhost:61616?autoGroup=true
</code></pre><p>Alternatively you can set the group id via the connection factory. All
messages sent with producers created via this connection factory will
set the <code>JMSXGroupID</code> to the specified value on all messages sent. This
can also be set in the JNDI context environment, e.g. <code>jndi.properties</code>.
Here&#39;s a simple example using the &quot;ConnectionFactory&quot; connection factory
which is available in the context by default:</p>
<pre><code>java.naming.factory.initial=org.apache.activemq.artemis.jndi.ActiveMQInitialContextFactory
connectionFactory.myConnectionFactory=tcp://localhost:61616?roupID=Group-0
</code></pre><h2 id="example">Example</h2>
<p>See the [examples](examples.md} chapter for an example which shows how message groups are configured and used with JMS and via a connection factory.</p>
<h2 id="clustered-grouping">Clustered Grouping</h2>
<p>Using message groups in a cluster is a bit more complex. This is because
messages with a particular group id can arrive on any node so each node
needs to know about which group id&#39;s are bound to which consumer on
which node. The consumer handling messages for a particular group id may
be on a different node of the cluster, so each node needs to know this
information so it can route the message correctly to the node which has
that consumer.</p>
<p>To solve this there is the notion of a grouping handler. Each node will
have its own grouping handler and when a messages is sent with a group
id assigned, the handlers will decide between them which route the
message should take.</p>
<p>There are 2 types of handlers; Local and Remote. Each cluster should
choose 1 node to have a local grouping handler and all the other nodes
should have remote handlers- it&#39;s the local handler that actually makes
the decision as to what route should be used, all the other remote
handlers converse with this. Here is a sample config for both types of
handler, this should be configured in the <em>broker.xml</em>
file.</p>
<pre><code>&lt;grouping-handler name=&quot;my-grouping-handler&quot;&gt;
   &lt;type&gt;LOCAL&lt;/type&gt;
   &lt;address&gt;jms&lt;/address&gt;
   &lt;timeout&gt;5000&lt;/timeout&gt;
&lt;/grouping-handler&gt;

&lt;grouping-handler name=&quot;my-grouping-handler&quot;&gt;
   &lt;type&gt;REMOTE&lt;/type&gt;
   &lt;address&gt;jms&lt;/address&gt;
   &lt;timeout&gt;5000&lt;/timeout&gt;
&lt;/grouping-handler&gt;
</code></pre><p>The <em>address</em> attribute refers to a <a href="#clusters.address">cluster connection and the address
it uses</a>, refer to the clustering section on how to
configure clusters. The <em>timeout</em> attribute referees to how long to wait
for a decision to be made, an exception will be thrown during the send
if this timeout is reached, this ensures that strict ordering is kept.</p>
<p>The decision as to where a message should be routed to is initially
proposed by the node that receives the message. The node will pick a
suitable route as per the normal clustered routing conditions, i.e.
round robin available queues, use a local queue first and choose a queue
that has a consumer. If the proposal is accepted by the grouping
handlers the node will route messages to this queue from that point on,
if rejected an alternative route will be offered and the node will again
route to that queue indefinitely. All other nodes will also route to the
queue chosen at proposal time. Once the message arrives at the queue
then normal single server message group semantics take over and the
message is pinned to a consumer on that queue.</p>
<p>You may have noticed that there is a single point of failure with the
single local handler. If this node crashes then no decisions will be
able to be made. Any messages sent will be not be delivered and an
exception thrown. To avoid this happening Local Handlers can be
replicated on another backup node. Simple create your back up node and
configure it with the same Local handler.</p>
<h2 id="clustered-grouping-best-practices">Clustered Grouping Best Practices</h2>
<p>Some best practices should be followed when using clustered grouping:</p>
<ol>
<li><p>Make sure your consumers are distributed evenly across the different
nodes if possible. This is only an issue if you are creating and
closing consumers regularly. Since messages are always routed to the
same queue once pinned, removing a consumer from this queue may
leave it with no consumers meaning the queue will just keep
receiving the messages. Avoid closing consumers or make sure that
you always have plenty of consumers, i.e., if you have 3 nodes have
3 consumers.</p>
</li>
<li><p>Use durable queues if possible. If queues are removed once a group
is bound to it, then it is possible that other nodes may still try
to route messages to it. This can be avoided by making sure that the
queue is deleted by the session that is sending the messages. This
means that when the next message is sent it is sent to the node
where the queue was deleted meaning a new proposal can successfully
take place. Alternatively you could just start using a different
group id.</p>
</li>
<li><p>Always make sure that the node that has the Local Grouping Handler
is replicated. These means that on failover grouping will still
occur.</p>
</li>
<li><p>In case you are using group-timeouts, the remote node should have a
smaller group-timeout with at least half of the value on the main
coordinator. This is because this will determine how often the
last-time-use value should be updated with a round trip for a
request to the group between the nodes.</p>
</li>
</ol>
<h2 id="clustered-grouping-example">Clustered Grouping Example</h2>
<p>See the <a href="examples.html">examples</a> chapter for an example of how to configure message groups with a ActiveMQ Artemis Cluster.</p>

                    
                    </section>
                
                
                </div>
            </div>
        </div>

        
        <a href="./last-value-queues.html" class="navigation navigation-prev " aria-label="Previous page: Last-Value Queues"><i class="fa fa-angle-left"></i></a>
        
        
        <a href="./pre-acknowledge.html" class="navigation navigation-next " aria-label="Next page: Extra Acknowledge Modes"><i class="fa fa-angle-right"></i></a>
        
    </div>
</div>

        
<script src="gitbook/app.js"></script>

    
    <script src="https://cdn.mathjax.org/mathjax/2.4-latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    

    
    <script src="gitbook/plugins/gitbook-plugin-mathjax/plugin.js"></script>
    

<script>
require(["gitbook"], function(gitbook) {
    var config = {"fontSettings":{"theme":null,"family":"sans","size":2}};
    gitbook.start(config);
});
</script>

        
    </body>
    
</html>

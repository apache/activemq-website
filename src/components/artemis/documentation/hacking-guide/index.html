<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.23">
<link rel="icon" type="image/png" href="images/favicon.png">
<title>Apache ActiveMQ Artemis Hacking Guide</title>
<link rel="stylesheet" href="css/asciidoctor.css">
<link rel="stylesheet" href="css/font-awesome.css">
<link rel="stylesheet" href="css/rouge-github.css">
</head>
<body class="book toc2 toc-left">
<div id="header">
<h1>Apache ActiveMQ Artemis Hacking Guide</h1>
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#working-with-the-code">1. Working with the Code</a>
<ul class="sectlevel2">
<li><a href="#initial-steps">1.1. Initial Steps</a></li>
<li><a href="#typical-development-cycle">1.2. Typical development cycle</a></li>
<li><a href="#other-common-tasks">1.3. Other common tasks</a></li>
<li><a href="#adding-new-dependencies">1.4. Adding New Dependencies</a></li>
</ul>
</li>
<li><a href="#building">2. Building</a>
<ul class="sectlevel2">
<li><a href="#full-release">2.1. Full Release</a></li>
<li><a href="#full-release-without-docs">2.2. Full Release without docs</a></li>
<li><a href="#only-docs">2.3. Only docs</a></li>
<li><a href="#offline">2.4. Offline</a></li>
<li><a href="#building-the-async-io-library">2.5. Building the ASYNC IO library</a></li>
<li><a href="#open-web-application-security-project-owasp-report">2.6. Open Web Application Security Project (OWASP) Report</a></li>
<li><a href="#snapshot-builds">2.7. Snapshot Builds</a></li>
</ul>
</li>
<li><a href="#tests">3. Tests</a>
<ul class="sectlevel2">
<li><a href="#running-tests">3.1. Running Tests</a></li>
<li><a href="#writing-tests">3.2. Writing Tests</a></li>
<li><a href="#writing-web-tests">3.3. Writing Web Tests</a></li>
<li><a href="#keys-for-writing-good-tests">3.4. Keys for writing good tests</a></li>
</ul>
</li>
<li><a href="#code-coverage-report">4. Code coverage report</a>
<ul class="sectlevel2">
<li><a href="#getting-jacoco-exec-files">4.1. Getting JaCoCo exec files</a></li>
<li><a href="#generate-jacoco-reports">4.2. Generate JaCoCo reports</a></li>
<li><a href="#merge-jacoco-exec-files-to-one">4.3. Merge JaCoCo exec files to one</a></li>
</ul>
</li>
<li><a href="#validating-releases">5. Validating releases</a>
<ul class="sectlevel2">
<li><a href="#setting-up-the-maven-repository">5.1. Setting up the maven repository</a></li>
<li><a href="#using-the-examples">5.2. Using the examples</a></li>
</ul>
</li>
<li><a href="#notes-for-maintainers">6. Notes for Maintainers</a>
<ul class="sectlevel2">
<li><a href="#using-the-dev-profile">6.1. Using the <code>dev</code> profile.</a></li>
<li><a href="#commit-messages">6.2. Commit Messages</a></li>
<li><a href="#configuring-git-repositories">6.3. Configuring Git repositories</a></li>
<li><a href="#merging-and-pushing-pull-requests">6.4. Merging and pushing pull requests</a></li>
<li><a href="#using-the-automated-script">6.5. Using the automated script</a></li>
<li><a href="#use-a-separate-branch-for-your-changes">6.6. Use a separate branch for your changes</a></li>
<li><a href="#notes">6.7. Notes</a></li>
</ul>
</li>
<li><a href="#history">7. History</a>
<ul class="sectlevel2">
<li><a href="#rebasing-original-donation">7.1. Rebasing original donation</a></li>
</ul>
</li>
<li><a href="#legal-notice">8. Legal Notice</a></li>
</ul>
</div>
</div>
<div id="content">
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>This hacking guide outlines how developers can get involved in contributing to the Apache ActiveMQ Artemis project.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="working-with-the-code"><a class="anchor" href="#working-with-the-code"></a><a class="link" href="#working-with-the-code">1. Working with the Code</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>While the canonical Apache ActiveMQ Artemis git repository is hosted on Apache hardware at <a href="https://gitbox.apache.org/repos/asf/activemq-artemis.git" class="bare">https://gitbox.apache.org/repos/asf/activemq-artemis.git</a> contributors are encouraged (but not required) to use a mirror on GitHub for collaboration and pull-request review functionality.
Follow the steps below to get set up with GitHub, etc.</p>
</div>
<div class="paragraph">
<p>If you do not wish to use GitHub for whatever reason you can follow the overall process outlined in the "Typical development cycle" section below but instead attach <a href="https://git-scm.com/docs/git-format-patch">a patch file</a> to the related JIRA or an email to the <a href="http://activemq.apache.org/mailing-lists.html">dev list</a>.</p>
</div>
<div class="sect2">
<h3 id="initial-steps"><a class="anchor" href="#initial-steps"></a><a class="link" href="#initial-steps">1.1. Initial Steps</a></h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Create a GitHub account if you don&#8217;t have one already</p>
<div class="paragraph">
<p><a href="https://github.com" class="bare">https://github.com</a></p>
</div>
</li>
<li>
<p>Fork the apache-artemis repository into your account</p>
<div class="paragraph">
<p><a href="https://github.com/apache/activemq-artemis" class="bare">https://github.com/apache/activemq-artemis</a></p>
</div>
</li>
<li>
<p>Clone your newly forked copy onto your local workspace:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight nowrap"><code data-lang="sh"><span class="nv">$ </span>git clone git@github.com:&lt;your-user-name&gt;/activemq-artemis.git
Cloning into <span class="s1">'activemq-artemis'</span>...
remote: Counting objects: 63800, <span class="k">done</span><span class="nb">.</span>
remote: Compressing objects: 100% <span class="o">(</span>722/722<span class="o">)</span>, <span class="k">done</span><span class="nb">.</span>
remote: Total 63800 <span class="o">(</span>delta 149<span class="o">)</span>, reused 0 <span class="o">(</span>delta 0<span class="o">)</span>, pack-reused 62748
Receiving objects: 100% <span class="o">(</span>63800/63800<span class="o">)</span>, 18.28 MiB | 3.16 MiB/s, <span class="k">done</span><span class="nb">.</span>
Resolving deltas: 100% <span class="o">(</span>28800/28800<span class="o">)</span>, <span class="k">done</span><span class="nb">.</span>
Checking connectivity... <span class="k">done</span><span class="nb">.</span>

<span class="nv">$ </span><span class="nb">cd </span>activemq-artemis</code></pre>
</div>
</div>
</li>
<li>
<p>Add a remote reference to <code>upstream</code> for pulling future updates</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight nowrap"><code data-lang="sh"><span class="nv">$ </span>git remote add upstream https://github.com/apache/activemq-artemis</code></pre>
</div>
</div>
</li>
<li>
<p>Build with Maven</p>
<div class="paragraph">
<p>Typically developers will want to build using the <code>dev</code> profile which enables license and code style checks.
For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight nowrap"><code data-lang="sh"><span class="nv">$ </span>mvn <span class="nt">-Pdev</span> <span class="nb">install</span>
...
<span class="o">[</span>INFO] <span class="nt">------------------------------------------------------------------------</span>
<span class="o">[</span>INFO] Reactor Summary:
<span class="o">[</span>INFO]
<span class="o">[</span>INFO] ActiveMQ Artemis Parent ........................... SUCCESS <span class="o">[</span>2.298s]
<span class="o">[</span>INFO] ActiveMQ Artemis Commons .......................... SUCCESS <span class="o">[</span>1.821s]
<span class="o">[</span>INFO] ActiveMQ Artemis Selector Implementation .......... SUCCESS <span class="o">[</span>0.767s]
<span class="o">[</span>INFO] ActiveMQ Artemis Native POM ....................... SUCCESS <span class="o">[</span>0.189s]
<span class="o">[</span>INFO] ActiveMQ Artemis Journal .......................... SUCCESS <span class="o">[</span>0.646s]
<span class="o">[</span>INFO] ActiveMQ Artemis Core Client ...................... SUCCESS <span class="o">[</span>5.969s]
<span class="o">[</span>INFO] ActiveMQ Artemis JMS Client ....................... SUCCESS <span class="o">[</span>2.110s]
<span class="o">[</span>INFO] ActiveMQ Artemis Server ........................... SUCCESS <span class="o">[</span>11.540s]
...
<span class="o">[</span>INFO] ActiveMQ Artemis stress Tests ..................... SUCCESS <span class="o">[</span>0.332s]
<span class="o">[</span>INFO] ActiveMQ Artemis performance Tests ................ SUCCESS <span class="o">[</span>0.174s]
<span class="o">[</span>INFO] <span class="nt">------------------------------------------------------------------------</span>
<span class="o">[</span>INFO] BUILD SUCCESS
<span class="o">[</span>INFO] <span class="nt">------------------------------------------------------------------------</span></code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="typical-development-cycle"><a class="anchor" href="#typical-development-cycle"></a><a class="link" href="#typical-development-cycle">1.2. Typical development cycle</a></h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Identify a task (e.g. a bug to fix or feature to implement)</p>
<div class="paragraph">
<p><a href="https://issues.apache.org/jira/browse/ARTEMIS" class="bare">https://issues.apache.org/jira/browse/ARTEMIS</a></p>
</div>
</li>
<li>
<p>Create a topic branch in your local git repo to do your work</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight nowrap"><code data-lang="console"><span class="gp">$</span><span class="w"> </span>git checkout <span class="nt">-b</span> my_cool_feature</code></pre>
</div>
</div>
</li>
<li>
<p>Make the changes and commit one or more times</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight nowrap"><code data-lang="console"><span class="gp">$</span><span class="w"> </span>git commit</code></pre>
</div>
</div>
<div id="commitMessageDetails" class="paragraph">
<p>When you commit your changes you will need to supply a commit message.
We follow the  50/72 git commit message format as recommended in the <a href="https://git-scm.com/book/en/v2/Distributed-Git-Contributing-to-a-Project">official Git book</a>.
An ActiveMQ Artemis commit message should be formatted in the following manner:</p>
</div>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Add the first line with the summary, using maximum 50 characters.
Start the summary with the jira key (ARTEMIS-XXX) followed by a brief description of the change.
Use the prefix <code>NO-JIRA</code> only for a very small insignificant change, like a typo or a small doc fix.
Bug fixes, features or any code change, really should be accompanied by a jira, so they can clearly be reported in the release notes.</p>
</li>
<li>
<p>Insert a single blank line after the first line.</p>
</li>
<li>
<p>Provide a detailed description of the change in the following lines, breaking paragraphs where needed.
These lines should be wrapped at 72 characters.</p>
<div class="paragraph">
<p>An example correctly formatted commit message:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="nowrap">ARTEMIS-123 Add new commit msg format to README

Adds a description of the new commit message format as well as examples
of well formatted commit messages to the README.md.  This is required
to enable developers to quickly identify what the commit is intended to
do and why the commit was added.</pre>
</div>
</div>
</li>
</ol>
</div>
</li>
<li>
<p>Occasionally you&#8217;ll want to push your commit(s) to GitHub for safe-keeping and/or sharing with others.</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight nowrap"><code data-lang="console"><span class="gp">$</span><span class="w"> </span>git push origin my_cool_feature</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that git push references the branch you are pushing and defaults to <code>main</code>, not your working branch.</p>
</div>
</li>
<li>
<p><a href="https://activemq.apache.org/contact">Discuss your planned changes</a> (if you want feedback)</p>
</li>
<li>
<p>Once you&#8217;re finished coding your feature/fix then rebase your branch against the latest main (applies your patches  on top of main)</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight nowrap"><code data-lang="console"><span class="gp">$</span><span class="w"> </span>git fetch upstream
<span class="gp">$</span><span class="w"> </span>git rebase <span class="nt">-i</span> upstream/main</code></pre>
</div>
</div>
<div class="paragraph">
<p>If you have conflicts fix them and rerun <code>rebase</code>. The <code>-f</code> forces the push and alters history. See the note below</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight nowrap"><code data-lang="console"><span class="gp">$</span><span class="w"> </span>git push <span class="nt">-f</span> origin my_cool_feature</code></pre>
</div>
</div>
<div class="paragraph">
<p>The <code>rebase -i</code> triggers an interactive update which also allows you to combine commits, alter commit messages etc.
It&#8217;s a good idea to make the commit log very nice for external consumption (e.g.
by squashing all related commits  into a single commit.
Note that rebasing and/or using <code>push -f</code> can alter history.
While this is great for making a  clean patch, it is unfriendly to anyone who has forked your branch.
Therefore you&#8217;ll want to make sure that you  either work in a branch that you don&#8217;t share, or if you do share it, tell them you are about to revise the branch  history (and thus, they will then need to rebase on top of your branch once you push it out).</p>
</div>
</li>
<li>
<p>Get your changes merged into upstream</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Send a GitHub pull request, by clicking the pull request link while in your repo&#8217;s fork.</p>
</li>
<li>
<p>An email will automatically be sent to the ActiveMQ developer list.</p>
</li>
<li>
<p>As part of the review you may see an automated test run comment on your request.</p>
</li>
<li>
<p>After review a maintainer will merge your PR into the canonical git repository at which point those changes will  be synced with the GitHub mirror repository (i.e. your <code>main</code>) and your PR will be closed by the <code>asfgit</code> bot.</p>
</li>
</ol>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="other-common-tasks"><a class="anchor" href="#other-common-tasks"></a><a class="link" href="#other-common-tasks">1.3. Other common tasks</a></h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Pulling updates from upstream</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight nowrap"><code data-lang="console"><span class="gp">$</span><span class="w"> </span>git pull <span class="nt">--rebase</span> upstream main</code></pre>
</div>
</div>
<div class="paragraph">
<p>(<code>--rebase</code> will automatically move your local commits, if any, on top of the latest branch you pull from;
you can leave it off if you do not have any local commits).</p>
</div>
<div class="paragraph">
<p>One last option, which some prefer, is to avoid using pull altogether, and just use fetch + rebase (this is of course more typing).
For example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight nowrap"><code data-lang="console"><span class="gp">$</span><span class="w"> </span>git fetch upstream
<span class="gp">$</span><span class="w"> </span>git pull</code></pre>
</div>
</div>
</li>
<li>
<p>Pushing pulled updates (or local commits if you aren&#8217;t using topic branches) to your private GitHub repo (origin)</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight nowrap"><code data-lang="console"><span class="gp">$</span><span class="w"> </span>git push
<span class="go">Counting objects: 192, done.
Delta compression using up to 4 threads.
Compressing objects: 100% (44/44), done.
Writing objects: 100% (100/100), 10.67 KiB, done.
Total 100 (delta 47), reused 100 (delta 47)
</span><span class="gp">To git@github.com:&lt;your-user-name&gt;</span>/apache-artemis.git
<span class="gp">3382570..1fa25df  main -&gt;</span><span class="w"> </span>main</code></pre>
</div>
</div>
<div class="paragraph">
<p>You might need to specify <code>-f</code> to force the changes.</p>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="adding-new-dependencies"><a class="anchor" href="#adding-new-dependencies"></a><a class="link" href="#adding-new-dependencies">1.4. Adding New Dependencies</a></h3>
<div class="paragraph">
<p>Due to incompatibilities between some open source licenses and the Apache v2.0 license (that this project is licensed under) care must be taken when adding new dependencies to the project.
The Apache Software Foundation 3rd party licensing  policy has more information here: <a href="https://www.apache.org/legal/3party.html" class="bare">https://www.apache.org/legal/3party.html</a></p>
</div>
<div class="paragraph">
<p>To keep track of all licenses in ActiveMQ Artemis, new dependencies must be added in either the top level <code>pom.xml</code> or in <code>test/pom.xml</code> (depending on whether this is a test only dependency or if it is used in the main code base).
The dependency should be added under the dependency management section with version and labelled with a comment highlighting the license for the dependency version.
See existing dependencies in the main <code>pom.xml</code> for examples.
The dependency can then be added to individual ActiveMQ Artemis modules <em>without</em> the version specified (the version is implied from the dependency management section of the top level pom).
This allows ActiveMQ Artemis developers to keep track of all dependencies and licenses.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="building"><a class="anchor" href="#building"></a><a class="link" href="#building">2. Building</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>We use Apache Maven to build the code, distribution, etc. and to manage dependencies.</p>
</div>
<div class="paragraph">
<p>The minimum required Maven version is 3.0.0.</p>
</div>
<div class="paragraph">
<p>Note that there are some <a href="https://cwiki.apache.org/confluence/display/MAVEN/Maven+3.x+Compatibility+Notes">compatibility issues with Maven 3.X</a> still unsolved.
This is specially true for the <a href="https://maven.apache.org/plugins-archives/maven-site-plugin-3.3/maven-3.html">'site' plugin</a>.</p>
</div>
<div class="sect2">
<h3 id="full-release"><a class="anchor" href="#full-release"></a><a class="link" href="#full-release">2.1. Full Release</a></h3>
<div class="paragraph">
<p>To build the full release with the documentation &amp; JavaDocs:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight nowrap"><code data-lang="console"><span class="gp">$</span><span class="w"> </span>mvn <span class="nt">-Prelease</span> package</code></pre>
</div>
</div>
<div class="paragraph">
<p>To install it to your local maven repo:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight nowrap"><code data-lang="console"><span class="gp">$</span><span class="w"> </span>mvn <span class="nt">-Prelease</span> <span class="nb">install</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>For any build you can skip the tests using <code>-DskipTests</code> which will make the build <strong>much</strong> faster, e.g.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight nowrap"><code data-lang="console"><span class="gp">$</span><span class="w"> </span>mvn <span class="nt">-Prelease</span> package <span class="nt">-DskipTests</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="full-release-without-docs"><a class="anchor" href="#full-release-without-docs"></a><a class="link" href="#full-release-without-docs">2.2. Full Release without docs</a></h3>
<div class="paragraph">
<p>It is possible to build a distribution without the manuals and Javadocs.
simply run</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight nowrap"><code data-lang="console"><span class="gp">$</span><span class="w"> </span>mvn package</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="only-docs"><a class="anchor" href="#only-docs"></a><a class="link" href="#only-docs">2.3. Only docs</a></h3>
<div class="paragraph">
<p>From the <code>artemis-website</code> module run:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight nowrap"><code data-lang="console"><span class="gp">$</span><span class="w"> </span>mvn <span class="nt">-Prelease</span> package</code></pre>
</div>
</div>
<div class="paragraph">
<p>This will build the user manual (both HTML &amp; PDF), migration guide, hacking guide, &amp; JavaDocs.
Output will be placed in the <code>target/classes/user-manual</code>, <code>target/classes/migration-guide</code>, <code>target/classes/hacking-guide</code>, and <code>target/apidocs</code> directories respectively.</p>
</div>
<div class="paragraph">
<p>Generating the user manual&#8217;s PDF adds almost a minute to the build so this can be skipped using <code>-DskipWebsitePdfGeneration</code>.</p>
</div>
</div>
<div class="sect2">
<h3 id="offline"><a class="anchor" href="#offline"></a><a class="link" href="#offline">2.4. Offline</a></h3>
<div class="paragraph">
<p>Maven dependency:go-offline can be used to download various things the build needs. This necessitates some properties the build doesnt normally need set, so to make this work a helper profile called <code>go-offline</code> exists to have the os-maven-plugin set these properties based on the current environment. To run these together, do:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight nowrap"><code data-lang="console"><span class="gp">$</span><span class="w"> </span>mvn dependency:go-offline <span class="nt">-Pgo-offline</span>
<span class="gp">$</span><span class="w"> </span>mvn <span class="nt">-o</span> ...</code></pre>
</div>
</div>
<div class="paragraph">
<p>Alternatively you can simply specify the needed properties directly, based on your environment preference. For example, on a Linux x86-64 environment you could run:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight nowrap"><code data-lang="console"><span class="gp">$</span><span class="w"> </span>mvn dependency:go-offline <span class="nt">-Dos</span>.detected.name<span class="o">=</span>linux <span class="nt">-Dos</span>.detected.arch<span class="o">=</span>x86_64 <span class="nt">-Dos</span>.detected.classifier<span class="o">=</span>linux-x86_64
<span class="gp">$</span><span class="w"> </span>mvn <span class="nt">-o</span> ...</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="building-the-async-io-library"><a class="anchor" href="#building-the-async-io-library"></a><a class="link" href="#building-the-async-io-library">2.5. Building the ASYNC IO library</a></h3>
<div class="paragraph">
<p>ActiveMQ Artemis provides the <code>ASYNCIO</code> <code>journal-type</code> which interacts with the Linux kernel libaio library. The ASYNCIO journal type should be used where possible as it is far superior in terms of performance.</p>
</div>
<div class="paragraph">
<p>ActiveMQ Artemis does not ship with the Artemis Native ASYNCIO library in the <em>source</em> distribution. This need to be built prior to running <code>mvn install</code>, to ensure that the ASYNCIO journal type is available in the resulting build. Don&#8217;t worry if you don&#8217;t want to use ASYNCIO or your system does not support libaio, ActiveMQ Artemis will check at runtime to see if the required libraries and system dependencies are available, if not it will default to using NIO.</p>
</div>
<div class="paragraph">
<p>To build the ActiveMQ Artemis ASYNCIO native libraries, please follow <a href="https://github.com/apache/activemq-artemis-native">these instructions</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="open-web-application-security-project-owasp-report"><a class="anchor" href="#open-web-application-security-project-owasp-report"></a><a class="link" href="#open-web-application-security-project-owasp-report">2.6. Open Web Application Security Project (OWASP) Report</a></h3>
<div class="paragraph">
<p>If you wish to generate a report for dependency CVEs you may build with the <code>-Powasp</code> profile, e.g.:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight nowrap"><code data-lang="console"><span class="gp">$</span><span class="w"> </span>mvn <span class="nt">-Powasp</span> verify <span class="nt">-DskipTests</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The output for every module will be aggregated in <code>./target/dependency-check-report.html</code>.</p>
</div>
</div>
<div class="sect2">
<h3 id="snapshot-builds"><a class="anchor" href="#snapshot-builds"></a><a class="link" href="#snapshot-builds">2.7. Snapshot Builds</a></h3>
<div class="paragraph">
<p>Snapshot builds are available at <a href="https://repository.apache.org/content/repositories/snapshots/org/apache/activemq/apache-artemis/" class="bare">https://repository.apache.org/content/repositories/snapshots/org/apache/activemq/apache-artemis/</a>.</p>
</div>
<div class="paragraph">
<p>These are built by <a href="https://ci-builds.apache.org/job/ActiveMQ/job/ActiveMQ-Artemis-SNAPSHOT-Deploy/">this Apache CI job</a>.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="tests"><a class="anchor" href="#tests"></a><a class="link" href="#tests">3. Tests</a></h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="running-tests"><a class="anchor" href="#running-tests"></a><a class="link" href="#running-tests">3.1. Running Tests</a></h3>
<div class="paragraph">
<p>To run the unit tests:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight nowrap"><code data-lang="sh"><span class="nv">$ </span>mvn <span class="nt">-Ptests</span> <span class="nb">test</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Generating reports from unit tests:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight nowrap"><code data-lang="sh"><span class="nv">$ </span>mvn <span class="nb">install </span>site</code></pre>
</div>
</div>
<div class="paragraph">
<p>Running tests individually</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight nowrap"><code data-lang="sh"><span class="nv">$ </span>mvn <span class="nt">-Ptests</span> <span class="nt">-DfailIfNoTests</span><span class="o">=</span><span class="nb">false</span> <span class="nt">-Dtest</span><span class="o">=</span>&lt;test-name&gt; <span class="nb">test</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>where <code>&lt;test-name&gt;</code> is the name of the Test class without its package name.</p>
</div>
</div>
<div class="sect2">
<h3 id="writing-tests"><a class="anchor" href="#writing-tests"></a><a class="link" href="#writing-tests">3.2. Writing Tests</a></h3>
<div class="paragraph">
<p>The broker is comprised of POJOs so it&#8217;s simple to configure and run a broker instance and test particular functionality.
Even complex test-cases involving multiple clustered brokers are relatively easy to write.
Almost every test in the  test-suite follows this pattern - configure broker, start broker, test functionality, stop broker.</p>
</div>
<div class="paragraph">
<p>The test-suite uses JUnit to manage test execution and life-cycle.
Most tests extend <a href="https://github.com/apache/activemq-artemis/blob/main/artemis-server/src/test/java/org/apache/activemq/artemis/tests/util/ActiveMQTestBase.java"><code>org.apache.activemq.artemis.tests.util.ActiveMQTestBase</code></a> which contains JUnit setup and tear-down methods as well as a wealth of utility functions to configure, start, manage, and stop brokers as well as perform other common tasks.</p>
</div>
<div class="paragraph">
<p>Check out <a href="https://github.com/apache/activemq-artemis/blob/main/tests/integration-tests/src/test/java/org/apache/activemq/artemis/tests/integration/SimpleTest.java"><code>org.apache.activemq.artemis.tests.integration.SimpleTest</code></a>.
It&#8217;s a very simple test-case that extends <code>org.apache.activemq.artemis.tests.util.ActiveMQTestBase</code> and uses its methods to configure a server, run a test, and then <code>super.tearDown()</code> cleans it up once the test completes.
The test-case  includes comments to explain everything.
As the name implies, this is a simple test-case that demonstrates the most basic functionality of the test-suite.
A simple test like this takes less than a second to run on modern hardware.</p>
</div>
<div class="paragraph">
<p>Although <code>org.apache.activemq.artemis.tests.integration.SimpleTest</code> is simple it could be simpler still by extending <a href="https://github.com/apache/activemq-artemis/blob/main/artemis-server/src/test/java/org/apache/activemq/artemis/tests/util/SingleServerTestBase.java"><code>org.apache.activemq.artemis.tests.util.SingleServerTestBase</code></a>.
This class does all the setup of a simple server automatically and provides the test-case with a <code>ServerLocator</code>,  <code>ClientSessionFactory</code>, and <code>ClientSession</code> instance.
<a href="https://github.com/apache/activemq-artemis/blob/main//tests/integration-tests/src/test/java/org/apache/activemq/artemis/tests/integration/SingleServerSimpleTest.java"><code>org.apache.activemq.artemis.tests.integration.SingleServerSimpleTest</code></a> is an example based on <code>org.apache.activemq.artemis.tests.integration.SimpleTest</code> but extends <code>org.apache.activemq.artemis.tests.util.SingleServerTestBase</code> which eliminates all the setup and class variables which are provided by <code>SingleServerTestBase</code> itself.</p>
</div>
</div>
<div class="sect2">
<h3 id="writing-web-tests"><a class="anchor" href="#writing-web-tests"></a><a class="link" href="#writing-web-tests">3.3. Writing Web Tests</a></h3>
<div class="paragraph">
<p>The broker has a web console based on <a href="https://github.com/hawtio/hawtio">hawtio</a> and the <code>smoke-tests</code> are used to test it.
For instance, the <a href="https://github.com/apache/activemq-artemis/blob/main/tests/smoke-tests/src/test/java/org/apache/activemq/artemis/tests/smoke/console/ConsoleTest.java">ConsoleTest</a> checks the web console using the <a href="https://github.com/SeleniumHQ/selenium">selenium framework</a>.
The tests can be executed on the Chrome and Firefox browsers by using a remote server, local browsers or <a href="https://www.testcontainers.org/modules/webdriver_containers">testcontainers</a>.
To configure the browsers on which execute the tests set the <code>webdriver.browsers</code> property with the comma-separated list of the browsers, i.e. <code>-Dwebdriver.browsers=chrome,firefox</code>.
To use a remote server set the <code>webdriver.remote.server</code> property with the URL of the server, ie -Dwebdriver.remote.server=http://localhost:4444/wd/hub To use your local Google Chrome browser download the <a href="https://chromedriver.chromium.org/">WebDriver for Chrome</a> and set the <code>webdriver.chrome.driver</code> property with the WebDriver path, ie <code>-Dwebdriver.chrome.driver=/home/artemis/chromedriver_linux64/chromedriver</code>.
To use your local Firefox browser download the <a href="https://github.com/mozilla/geckodriver/">WebDriver for Firefox</a> and set the <code>webdriver.gecko.driver</code> property with the WebDriver path, ie <code>-Dwebdriver.gecko.driver=/home/artemis/geckodriver-linux64/geckodriver</code>.
To use <a href="https://www.testcontainers.org/modules/webdriver_containers">testcontainers</a> install docker.</p>
</div>
</div>
<div class="sect2">
<h3 id="keys-for-writing-good-tests"><a class="anchor" href="#keys-for-writing-good-tests"></a><a class="link" href="#keys-for-writing-good-tests">3.4. Keys for writing good tests</a></h3>
<div class="sect3">
<h4 id="use-logger-debug"><a class="anchor" href="#use-logger-debug"></a><a class="link" href="#use-logger-debug">3.4.1. Use logger.debug</a></h4>
<div class="ulist">
<ul>
<li>
<p>Please use <code>logger.debug</code> instead of <code>logger.info</code>.</p>
<div class="paragraph">
<p>On your classes, import the following:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight nowrap"><code data-lang="java"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">MyTest</span> <span class="o">{</span>
<span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">org</span><span class="o">.</span><span class="na">slf4j</span><span class="o">.</span><span class="na">Logger</span> <span class="n">log</span> <span class="o">=</span> <span class="n">org</span><span class="o">.</span><span class="na">slf4j</span><span class="o">.</span><span class="na">LoggerFactory</span><span class="o">.</span><span class="na">getLogger</span><span class="o">(</span><span class="n">$CLASS_NAME</span><span class="err">$</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>

     <span class="nd">@Test</span>
     <span class="kd">public</span> <span class="kt">void</span> <span class="nf">test</span><span class="o">()</span> <span class="o">{</span>
            <span class="n">log</span><span class="o">.</span><span class="na">debug</span><span class="o">(</span><span class="s">"Log only what you need please!"</span><span class="o">);</span>
     <span class="o">}</span>
<span class="o">}</span></code></pre>
</div>
</div>
</li>
<li>
<p>Please do not use <code>System.out.println()</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>As a general rule, only use <code>System.out</code> if you really intend an error to be on the reporting.
Debug information should be called through <code>logger.debug</code>.</p>
</div>
</div>
<div class="sect3">
<h4 id="avoid-leaks"><a class="anchor" href="#avoid-leaks"></a><a class="link" href="#avoid-leaks">3.4.2. Avoid leaks</a></h4>
<div class="paragraph">
<p>An important task for any test-case is to clean up all the resources it creates when it runs.
This includes the server instance itself and any resources created to connect to it (e.g. instances of <code>ServerLocator</code>, <code>ClientSessionFactory</code>, <code>ClientSession</code>, etc.).
This task is typically completed in the test&#8217;s <code>tearDown()</code> method.
However, <code>ActiveMQTestBase</code>  (and other classes which extend it) simplifies this process.
As <a href="https://github.com/apache/activemq-artemis/blob/main/tests/integration-tests/src/test/java/org/apache/activemq/artemis/tests/integration/SimpleTest.java"><code>org.apache.activemq.artemis.tests.integration.SimpleTest</code></a> demonstrates, there are several methods you can use when creating your test which will ensure proper clean up <em>automatically</em> when the test is torn down.
These include:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>All the overloaded <code>org.apache.activemq.artemis.tests.util.ActiveMQTestBase.createServer(..)</code> methods.
If you choose <em>not</em> to use one of these methods to create your <code>ActiveMQServer</code> instance then use the <code>addServer(ActiveMQServer)</code>  method to add the instance to the test-suite&#8217;s internal resource ledger.</p>
</li>
<li>
<p>Methods from <code>org.apache.activemq.artemis.tests.util.ActiveMQTestBase</code> to create a <code>ServerLocator</code> like  <code>createInVMNonHALocator</code> and <code>createNettyNonHALocator</code>.
If you choose <em>not</em> to use one of these methods then use  <code>addServerLocator(ServerLocator)</code> to add the locator to the test-suite&#8217;s internal resource ledger.</p>
</li>
<li>
<p><code>org.apache.activemq.artemis.tests.util.ActiveMQTestBase.createSessionFactory(ServerLocator)</code> for creating your session factory.
If you choose <em>not</em> to use this method then use <code>org.apache.activemq.artemis.tests.util.ActiveMQTestBase.addSessionFactory</code> to add the factory to the test-suite&#8217;s internal resource ledger.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="create-configurations"><a class="anchor" href="#create-configurations"></a><a class="link" href="#create-configurations">3.4.3. Create configurations</a></h4>
<div class="paragraph">
<p>There are numerous methods in <code>org.apache.activemq.artemis.tests.util.ActiveMQTestBase</code> to create a configuration.
These methods are named like create&#42;Config(..).
Each one creates a slightly different configuration but there is a lot of  overlap between them.</p>
</div>
<div class="paragraph">
<p>In any case, <code>org.apache.activemq.artemis.core.config.Configuration</code> is a <a href="https://en.wikipedia.org/wiki/Fluent_interface"><em>fluent</em></a> interface so it&#8217;s easy to customize however you need.</p>
</div>
</div>
<div class="sect3">
<h4 id="look-at-other-test-cases"><a class="anchor" href="#look-at-other-test-cases"></a><a class="link" href="#look-at-other-test-cases">3.4.4. Look at other test-cases</a></h4>
<div class="paragraph">
<p>If you need ideas on how to configure something or test something try looking through the test-suite at other test-cases which may be similar.
This is one of the best ways to learn how the test-suite works and how you can leverage the testing infrastructure to test your particular case.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="code-coverage-report"><a class="anchor" href="#code-coverage-report"></a><a class="link" href="#code-coverage-report">4. Code coverage report</a></h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="getting-jacoco-exec-files"><a class="anchor" href="#getting-jacoco-exec-files"></a><a class="link" href="#getting-jacoco-exec-files">4.1. Getting JaCoCo exec files</a></h3>
<div class="paragraph">
<p>Before you can generate code coverage report by JaCoCo tool, you need to get data about what lines of code were executed during testing.
These information are collected by JaCoCo agent and stored in JaCoCo exec files.
All you need to do is run the tests with <code>jacoco</code> maven profile.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight nowrap"><code data-lang="console"><span class="gp">$</span><span class="w"> </span>mvn <span class="nb">test</span> <span class="nt">-Ptests</span>,jacoco</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="generate-jacoco-reports"><a class="anchor" href="#generate-jacoco-reports"></a><a class="link" href="#generate-jacoco-reports">4.2. Generate JaCoCo reports</a></h3>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight nowrap"><code data-lang="console"><span class="gp">$</span><span class="w"> </span>mvn verify <span class="nt">-Pjacoco-generate-report</span> <span class="nt">-DskipTests</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>For generating JaCoCo reports only run the maven build with profile <code>jacoco-generate-report</code> as it is shown in the example above.
After the command was executed, in directory <code>target/jacoco-report</code> you can find reports in HTML and XML formats.</p>
</div>
</div>
<div class="sect2">
<h3 id="merge-jacoco-exec-files-to-one"><a class="anchor" href="#merge-jacoco-exec-files-to-one"></a><a class="link" href="#merge-jacoco-exec-files-to-one">4.3. Merge JaCoCo exec files to one</a></h3>
<div class="paragraph">
<p>Since ActiveMQ Artemis is divided into several modules, exec files are generated for each module separately.
If you need to merge them together to have all data in one place, you can do it by command below.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight nowrap"><code data-lang="console"><span class="gp">$</span><span class="w"> </span>mvn jacoco:merge <span class="nt">-N</span> <span class="nt">-Pjacoco</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="validating-releases"><a class="anchor" href="#validating-releases"></a><a class="link" href="#validating-releases">5. Validating releases</a></h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="setting-up-the-maven-repository"><a class="anchor" href="#setting-up-the-maven-repository"></a><a class="link" href="#setting-up-the-maven-repository">5.1. Setting up the maven repository</a></h3>
<div class="paragraph">
<p>When a release is proposed a maven repository is staged.</p>
</div>
<div class="paragraph">
<p>This information was extracted from <a href="https://maven.apache.org/guides/development/guide-testing-releases.html">Guide to Testing Staged Releases</a></p>
</div>
<div class="paragraph">
<p>For examples, the 1.1.0 release had the Maven Repository staged as <a href="https://repository.apache.org/content/repositories/orgapacheactivemq-1066" class="bare">https://repository.apache.org/content/repositories/orgapacheactivemq-1066</a>.</p>
</div>
<div class="paragraph">
<p>The first thing you need to do is to be able to use this release.
The easiest way we have found is to change your maven settings at <code>~/.m2/settings.xml</code>, setting up the staged repo.</p>
</div>
<div class="listingblock">
<div class="title">~/.m2/settings.xml</div>
<div class="content">
<pre class="rouge highlight nowrap"><code data-lang="xml"><span class="cp">&lt;?xml version="1.0" encoding="UTF-8" standalone="no"?&gt;</span>
<span class="nt">&lt;settings&gt;</span>
   <span class="nt">&lt;profiles&gt;</span>
      <span class="nt">&lt;profile&gt;</span>
         <span class="nt">&lt;id&gt;</span>activemq-artemis-test<span class="nt">&lt;/id&gt;</span>
         <span class="nt">&lt;repositories&gt;</span>
            <span class="nt">&lt;repository&gt;</span>
               <span class="nt">&lt;id&gt;</span>artemis-test<span class="nt">&lt;/id&gt;</span>
               <span class="nt">&lt;name&gt;</span>ActiveMQ Artemis Test<span class="nt">&lt;/name&gt;</span>
               <span class="nt">&lt;url&gt;</span>https://repository.apache.org/content/repositories/orgapacheactivemq-1066<span class="nt">&lt;/url&gt;</span>
               <span class="nt">&lt;layout&gt;</span>default<span class="nt">&lt;/layout&gt;</span>
               <span class="nt">&lt;releases&gt;</span>
                  <span class="nt">&lt;enabled&gt;</span>true<span class="nt">&lt;/enabled&gt;</span>
               <span class="nt">&lt;/releases&gt;</span>
               <span class="nt">&lt;snapshots&gt;</span>
                  <span class="nt">&lt;enabled&gt;</span>true<span class="nt">&lt;/enabled&gt;</span>
               <span class="nt">&lt;/snapshots&gt;</span>
            <span class="nt">&lt;/repository&gt;</span>
         <span class="nt">&lt;/repositories&gt;</span>

         <span class="nt">&lt;pluginRepositories&gt;</span>
            <span class="nt">&lt;pluginRepository&gt;</span>
               <span class="nt">&lt;id&gt;</span>artemis-test2<span class="nt">&lt;/id&gt;</span>
               <span class="nt">&lt;name&gt;</span>ActiveMQ Artemis Test<span class="nt">&lt;/name&gt;</span>
               <span class="nt">&lt;url&gt;</span>https://repository.apache.org/content/repositories/orgapacheactivemq-1066<span class="nt">&lt;/url&gt;</span>
               <span class="nt">&lt;releases&gt;</span>
                  <span class="nt">&lt;enabled&gt;</span>true<span class="nt">&lt;/enabled&gt;</span>
               <span class="nt">&lt;/releases&gt;</span>
               <span class="nt">&lt;snapshots&gt;</span>
                  <span class="nt">&lt;enabled&gt;</span>true<span class="nt">&lt;/enabled&gt;</span>
               <span class="nt">&lt;/snapshots&gt;</span>
            <span class="nt">&lt;/pluginRepository&gt;</span>
         <span class="nt">&lt;/pluginRepositories&gt;</span>
      <span class="nt">&lt;/profile&gt;</span>
   <span class="nt">&lt;/profiles&gt;</span>

   <span class="nt">&lt;activeProfiles&gt;</span>
      <span class="nt">&lt;activeProfile&gt;</span>activemq-artemis-test<span class="nt">&lt;/activeProfile&gt;</span>
   <span class="nt">&lt;/activeProfiles&gt;</span>
<span class="nt">&lt;/settings&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>After you configure this, all the maven objects will be available to your builds.</p>
</div>
</div>
<div class="sect2">
<h3 id="using-the-examples"><a class="anchor" href="#using-the-examples"></a><a class="link" href="#using-the-examples">5.2. Using the examples</a></h3>
<div class="paragraph">
<p>The Apache ActiveMQ Artemis examples will create servers and use most of the maven components as real application were supposed to do.
You can do this by running these examples after the <code>.m2</code> profile installations for the staged repository.</p>
</div>
<div class="paragraph">
<p>Of course you can use your own applications after you have staged the maven repository.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="notes-for-maintainers"><a class="anchor" href="#notes-for-maintainers"></a><a class="link" href="#notes-for-maintainers">6. Notes for Maintainers</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>ActiveMQ Artemis committers have write access to the Apache ActiveMQ Artemis repositories and will be responsible for acknowledging and pushing commits contributed via pull requests on GitHub.</p>
</div>
<div class="paragraph">
<p>Core ActiveMQ Artemis members are also able to push their own commits directly to the canonical Apache repository.
However, the expectation here is that the developer has made a good effort to test their changes and is reasonably confident that the changes that are being committed will not break the build.</p>
</div>
<div class="paragraph">
<p>What does it mean to be reasonably confident?
If the developer has run the same maven commands that the pull-request builds are running they can be reasonably confident.
Currently the <a href="https://builds.apache.org/job/ActiveMQ-Artemis-PR-Build/">PR build</a> runs this command:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight nowrap"><code data-lang="console"><span class="gp">$</span><span class="w"> </span>mvn <span class="nt">-Pfast-tests</span> <span class="nb">install</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>However, if the changes are significant, touches a wide area of code, or even if the developer just wants a second opinion they are encouraged to engage other members of the community to obtain an additional review prior to pushing.
This can easily be done via a pull request on GitHub, a patch file attached to an email or JIRA, commit to a branch in the Apache git repo, etc.
Having additional eyes looking at significant changes prior to committing to the main development branches is definitely encouraged if it helps obtain the "reasonable confidence" that the build is not broken and code quality has not decreased.</p>
</div>
<div class="paragraph">
<p>If the build does break then developer is expected to make their best effort to get the builds fixed in a reasonable amount of time.
If it cannot be fixed in a reasonable amount of time the commit can be reverted and re-reviewed.</p>
</div>
<div class="sect2">
<h3 id="using-the-dev-profile"><a class="anchor" href="#using-the-dev-profile"></a><a class="link" href="#using-the-dev-profile">6.1. Using the <code>dev</code> profile.</a></h3>
<div class="paragraph">
<p>Developers are encouraged to use the <code>dev</code> profile which will activate <a href="https://checkstyle.org/">CheckStyle</a> during the build:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight nowrap"><code data-lang="console"><span class="gp">$</span><span class="w"> </span>mvn <span class="nt">-Pdev</span> <span class="nb">install</span></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="commit-messages"><a class="anchor" href="#commit-messages"></a><a class="link" href="#commit-messages">6.2. Commit Messages</a></h3>
<div class="paragraph">
<p>Please ensure the commit messages follow the 50/72 format as described <a href="#commitMessageDetails">here</a>.
This format follows the recommendation from the <a href="https://git-scm.com/book/en/v2/Distributed-Git-Contributing-to-a-Project">official Git book</a>.</p>
</div>
</div>
<div class="sect2">
<h3 id="configuring-git-repositories"><a class="anchor" href="#configuring-git-repositories"></a><a class="link" href="#configuring-git-repositories">6.3. Configuring Git repositories</a></h3>
<div class="paragraph">
<p>Aside from the traditional <code>origin</code> and <code>upstream</code> repositories committers will need an additional reference for the canonical Apache git repository where they will be merging and pushing pull-requests.
For the purposes of this document, let&#8217;s assume these ref/repo associations already exist as described in the <a href="code.html">Working with the Code</a> section:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>origin</code> : <a href="https://github.com/(your-user-name)/activemq-artemis.git" class="bare">https://github.com/(your-user-name)/activemq-artemis.git</a></p>
</li>
<li>
<p><code>upstream</code> : <a href="https://github.com/apache/activemq-artemis" class="bare">https://github.com/apache/activemq-artemis</a></p>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Add the canonical Apache repository as a remote.
Here we call it <code>apache</code>.</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight nowrap"><code data-lang="console"><span class="gp">$</span><span class="w"> </span>git remote add apache https://gitbox.apache.org/repos/asf/activemq-artemis.git</code></pre>
</div>
</div>
</li>
<li>
<p>Add the following section to your <code>&lt;artemis-repo&gt;/.git/config</code> statement to fetch all pull requests sent to the GitHub mirror.
We are using <code>upstream</code> as the remote repo name (as noted above), but the remote repo name may be different if you choose.
Just be sure to edit all references to the remote repo name so it&#8217;s consistent.</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight nowrap"><code data-lang="console"><span class="go"> [remote "upstream"]
     url = git@github.com:apache/activemq-artemis.git
     fetch = +refs/heads/*:refs/remotes/upstream/*
     fetch = +refs/pull/*/head:refs/remotes/upstream/pr/*</span></code></pre>
</div>
</div>
</li>
</ol>
</div>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="merging-and-pushing-pull-requests"><a class="anchor" href="#merging-and-pushing-pull-requests"></a><a class="link" href="#merging-and-pushing-pull-requests">6.4. Merging and pushing pull requests</a></h3>
<div class="paragraph">
<p>Here are the basic commands to retrieve pull requests, merge, and push them to the canonical Apache repository:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Download all the remote branches etc. including all the pull requests.</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight nowrap"><code data-lang="console"><span class="gp">$</span><span class="w"> </span>git fetch <span class="nt">--all</span>
<span class="go">Fetching origin
Fetching upstream
remote: Counting objects: 566, done.
remote: Compressing objects: 100% (188/188), done.
remote: Total 566 (delta 64), reused 17 (delta 17), pack-reused 351
Receiving objects: 100% (566/566), 300.67 KiB | 0 bytes/s, done.
Resolving deltas: 100% (78/78), done.
From github.com:apache/activemq-artemis
</span><span class="gp">* [new ref]         refs/pull/105/head -&gt;</span><span class="w"> </span>upstream/pr/105</code></pre>
</div>
</div>
</li>
<li>
<p>Checkout the pull request you wish to review</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight nowrap"><code data-lang="console"><span class="gp">$</span><span class="w"> </span>git checkout <span class="nb">pr</span>/105 <span class="nt">-B</span> 105</code></pre>
</div>
</div>
</li>
<li>
<p>Rebase the branch against main, so the merge would happen at the top of the current main</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight nowrap"><code data-lang="console"><span class="gp">$</span><span class="w"> </span>git pull <span class="nt">--rebase</span> apache main</code></pre>
</div>
</div>
</li>
<li>
<p>Once you&#8217;ve reviewed the change and are ready to merge checkout <code>main</code>.</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight nowrap"><code data-lang="console"><span class="gp">$</span><span class="w"> </span>git checkout main</code></pre>
</div>
</div>
</li>
<li>
<p>Ensure you are up to date on your main also.</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight nowrap"><code data-lang="console"><span class="gp">$</span><span class="w"> </span>git pull <span class="nt">--rebase</span> apache main</code></pre>
</div>
</div>
</li>
<li>
<p>We actually recommend checking out main again, to make sure you wouldn&#8217;t add any extra commits by accident:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight nowrap"><code data-lang="console"><span class="gp">$</span><span class="w"> </span>git fetch apache
<span class="gp">$</span><span class="w"> </span>git checkout apache/main <span class="nt">-B</span> main</code></pre>
</div>
</div>
</li>
<li>
<p>Create a new merge commit from the pull-request.
IMPORTANT: The commit message here should be something like: "This closes #105" where "105" is the pull request ID.
The "#105" shows up as a link in the GitHub UI for navigating to the PR from the commit message.
This will ensure the github pull request is closed even if the commit ID changed due to eventual rebases.</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight nowrap"><code data-lang="console"><span class="gp">$</span><span class="w"> </span>git merge <span class="nt">--no-ff</span> 105 <span class="nt">-m</span> <span class="s2">"This closes #105"</span></code></pre>
</div>
</div>
</li>
<li>
<p>Push to the canonical Apache repo.</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight nowrap"><code data-lang="console"><span class="gp">$</span><span class="w"> </span>git push apache main</code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="using-the-automated-script"><a class="anchor" href="#using-the-automated-script"></a><a class="link" href="#using-the-automated-script">6.5. Using the automated script</a></h3>
<div class="paragraph">
<p>If you followed the naming conventions described here you can use the <code>scripts/rebase-PR.sh</code> script to automate the merging process.
This will execute the exact steps described on this previous section.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Simply use:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight nowrap"><code data-lang="console"><span class="gp">$</span><span class="w"> </span>&lt;checkout-directory&gt;/scripts/merge-pr.sh &lt;PR number&gt; Message on the PR</code></pre>
</div>
</div>
<div class="paragraph">
<p>Example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight nowrap"><code data-lang="console"><span class="gp">$</span><span class="w"> </span><span class="nb">pwd</span>
<span class="go">/checkouts/apache-activemq-artemis

</span><span class="gp">$</span><span class="w"> </span>./scripts/merge-PR.sh 175 ARTEMIS-229 address on Security Interface</code></pre>
</div>
</div>
<div class="paragraph">
<p>The previous example was taken from a real case that generated this <a href="https://github.com/apache/activemq-artemis/commit/e85bb3ca4a75b0f1dfbe717ff90b34309e2de794">merge commit on #175</a>.</p>
</div>
</li>
<li>
<p>After this you can push to the canonical Apache repo.</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight nowrap"><code data-lang="console"><span class="gp">$</span><span class="w"> </span>git push apache main</code></pre>
</div>
</div>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="use-a-separate-branch-for-your-changes"><a class="anchor" href="#use-a-separate-branch-for-your-changes"></a><a class="link" href="#use-a-separate-branch-for-your-changes">6.6. Use a separate branch for your changes</a></h3>
<div class="paragraph">
<p>It is recommended that you work away from main for two reasons:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>When you send a PR, your PR branch could be rebased during the process and your commit ID changed.
You might get unexpected conflicts while rebasing your old branch.</p>
</li>
<li>
<p>You could end up pushing things upstream that you didn&#8217;t intend to.
Minimize your risks by working on a branch away from main.</p>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="notes"><a class="anchor" href="#notes"></a><a class="link" href="#notes">6.7. Notes</a></h3>
<div class="paragraph">
<p>The GitHub mirror repository (i.e. <code>upstream</code>) is cloning the canonical Apache repository.
Because of this there may be a slight delay between when a commit is pushed to the Apache repo and when that commit is reflected in the GitHub mirror.
This may cause some difficulty when trying to push a PR to <code>apache</code> that has been merged on the out-of-date GitHub mirror.
You can wait for the mirror to update before performing the steps above or you can change your local main branch to track the main branch on the canonical Apache repository rather than the main branch on the GitHub mirror:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight nowrap"><code data-lang="console"><span class="gp">$</span><span class="w"> </span>git branch main <span class="nt">-u</span> apache/main</code></pre>
</div>
</div>
<div class="paragraph">
<p>Where <code>apache</code> points to the canonical Apache repository.</p>
</div>
<div class="paragraph">
<p>If you&#8217;d like your local main branch to always track <code>upstream/main</code> (i.e. the GitHub mirror) then another way to achieve this is to add another branch that tracks <code>apache/main</code> and push from that branch e.g.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight nowrap"><code data-lang="console"><span class="gp">$</span><span class="w"> </span>git checkout main
<span class="gp">$</span><span class="w"> </span>git branch apache_main <span class="nt">--track</span> apache/main
<span class="gp">$</span><span class="w"> </span>git pull
<span class="gp">$</span><span class="w"> </span>git merge <span class="nt">--no-ff</span> <span class="nb">pr</span>/105
<span class="gp">$</span><span class="w"> </span>git push</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="history"><a class="anchor" href="#history"></a><a class="link" href="#history">7. History</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>The Apache ActiveMQ Artemis project was started in October 2014.
The Artemis code base was seeded with a code donation granted by Red Hat, of the HornetQ project.
The code donation process consisted of taking a snapshot of the latest HornetQ code base and contributing this snapshot as an <a href="https://issues.apache.org/jira/browse/ARTEMIS-1">initial git commit</a> into the Artemis git repository.</p>
</div>
<div class="paragraph">
<p>The HornetQ commit history is preserved and can be accessed here: <a href="https://github.com/hornetq/hornetq/tree/apache-donation" class="bare">https://github.com/hornetq/hornetq/tree/apache-donation</a></p>
</div>
<div class="paragraph">
<p>Credit should be given to those developers who contributed to the HornetQ project.
The top 10 committers are highlighted here:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Clebert Suconic</p>
</li>
<li>
<p>Tim Fox</p>
</li>
<li>
<p>Francisco Borges</p>
</li>
<li>
<p>Andy Taylor</p>
</li>
<li>
<p>Jeff Mesnil</p>
</li>
<li>
<p>Ovidiu Feodorov</p>
</li>
<li>
<p>Howard Gao</p>
</li>
<li>
<p>Justin Bertram</p>
</li>
<li>
<p>Trustin Lee</p>
</li>
<li>
<p>Adrian Brock</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>For more information please visit the <a href="https://github.com/hornetq/hornetq/tree/apache-donation">HornetQ GitHub project</a>.</p>
</div>
<div class="sect2">
<h3 id="rebasing-original-donation"><a class="anchor" href="#rebasing-original-donation"></a><a class="link" href="#rebasing-original-donation">7.1. Rebasing original donation</a></h3>
<div class="paragraph">
<p>It may be useful to look at the donation history combined with the artemis history.
It is the case when eventually looking at old changes.</p>
</div>
<div class="paragraph">
<p>For that there is a script that will rebase main against the donation branch under main/scripts:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>rebase-donation.sh</code></p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="legal-notice"><a class="anchor" href="#legal-notice"></a><a class="link" href="#legal-notice">8. Legal Notice</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>Licensed to the Apache Software Foundation (ASF) under one or more contributor license agreements.
See the NOTICE file distributed with this work for additional information regarding copyright ownership.
The ASF licenses this file to You under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at</p>
</div>
<div class="paragraph">
<p><a href="http://www.apache.org/licenses/LICENSE-2.0" class="bare">http://www.apache.org/licenses/LICENSE-2.0</a></p>
</div>
<div class="paragraph">
<p>Unless required by applicable law or agreed to in writing, software distributed under the License is distributed on an "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and limitations under the License.</p>
</div>
</div>
</div>
</div>
</body>
</html>
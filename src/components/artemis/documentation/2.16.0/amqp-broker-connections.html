
<!DOCTYPE HTML>
<html lang="" >
    <head>
        <meta charset="UTF-8">
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <title>Broker Connections Â· ActiveMQ Artemis Documentation</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="description" content="">
        <meta name="generator" content="GitBook 3.2.3">
        
        
        
    
    <link rel="stylesheet" href="gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="gitbook/gitbook-plugin-highlight/website.css">
                
            
                
                <link rel="stylesheet" href="gitbook/gitbook-plugin-search/search.css">
                
            
                
                <link rel="stylesheet" href="gitbook/gitbook-plugin-fontsettings/website.css">
                
            
        

    

    
        
    
        
    
        
    
        
    
        
    
        
    

        
    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="gitbook/images/favicon.ico" type="image/x-icon">

    
    <link rel="next" href="mqtt.html" />
    
    
    <link rel="prev" href="amqp.html" />
    

    </head>
    <body>
        
<div class="book">
    <div class="book-summary">
        
            
<div id="book-search-input" role="search">
    <input type="text" placeholder="Type to search" />
</div>

            
                <nav role="navigation">
                


<ul class="summary">
    
    

    

    
        
        
    
        <li class="chapter " data-level="1.1" data-path="./">
            
                <a href="./">
            
                    
                    Introduction
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2" data-path="notice.html">
            
                <a href="notice.html">
            
                    
                    Legal Notice
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3" data-path="preface.html">
            
                <a href="preface.html">
            
                    
                    Preface
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4" data-path="project-info.html">
            
                <a href="project-info.html">
            
                    
                    Project Info
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5" data-path="versions.html">
            
                <a href="versions.html">
            
                    
                    Versions
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6" data-path="messaging-concepts.html">
            
                <a href="messaging-concepts.html">
            
                    
                    Messaging Concepts
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7" data-path="architecture.html">
            
                <a href="architecture.html">
            
                    
                    Architecture
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8" data-path="using-server.html">
            
                <a href="using-server.html">
            
                    
                    Using the Server
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9" data-path="upgrading.html">
            
                <a href="upgrading.html">
            
                    
                    Upgrading
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10" data-path="address-model.html">
            
                <a href="address-model.html">
            
                    
                    Address Model
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.11" data-path="protocols-interoperability.html">
            
                <a href="protocols-interoperability.html">
            
                    
                    Protocols and Interoperability
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.12" data-path="amqp.html">
            
                <a href="amqp.html">
            
                    
                    AMQP
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter active" data-level="1.12.1" data-path="amqp-broker-connections.html">
            
                <a href="amqp-broker-connections.html">
            
                    
                    Broker Connections
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.13" data-path="mqtt.html">
            
                <a href="mqtt.html">
            
                    
                    MQTT
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.14" data-path="stomp.html">
            
                <a href="stomp.html">
            
                    
                    STOMP
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.15" data-path="openwire.html">
            
                <a href="openwire.html">
            
                    
                    OpenWire
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.16" data-path="core.html">
            
                <a href="core.html">
            
                    
                    Core
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.17" data-path="jms-core-mapping.html">
            
                <a href="jms-core-mapping.html">
            
                    
                    Mapping JMS Concepts to the Core API
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.18" data-path="using-jms.html">
            
                <a href="using-jms.html">
            
                    
                    Using JMS
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.19" data-path="client-classpath.html">
            
                <a href="client-classpath.html">
            
                    
                    The Client Classpath
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.20" data-path="examples.html">
            
                <a href="examples.html">
            
                    
                    Examples
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.21" data-path="wildcard-routing.html">
            
                <a href="wildcard-routing.html">
            
                    
                    Routing Messages With Wild Cards
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.22" data-path="wildcard-syntax.html">
            
                <a href="wildcard-syntax.html">
            
                    
                    Wildcard Syntax
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.23" data-path="filter-expressions.html">
            
                <a href="filter-expressions.html">
            
                    
                    Filter Expressions
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.24" data-path="persistence.html">
            
                <a href="persistence.html">
            
                    
                    Persistence
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.25" data-path="configuring-transports.html">
            
                <a href="configuring-transports.html">
            
                    
                    Configuring Transports
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.26" data-path="config-reload.html">
            
                <a href="config-reload.html">
            
                    
                    Configuration Reload
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.27" data-path="connection-ttl.html">
            
                <a href="connection-ttl.html">
            
                    
                    Detecting Dead Connections
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.28" data-path="slow-consumers.html">
            
                <a href="slow-consumers.html">
            
                    
                    Detecting Slow Consumers
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.29" data-path="network-isolation.html">
            
                <a href="network-isolation.html">
            
                    
                    Avoiding Network Isolation
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.30" data-path="critical-analysis.html">
            
                <a href="critical-analysis.html">
            
                    
                    Detecting Broker Issues (Critical Analysis)
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.31" data-path="transaction-config.html">
            
                <a href="transaction-config.html">
            
                    
                    Resource Manager Configuration
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.32" data-path="flow-control.html">
            
                <a href="flow-control.html">
            
                    
                    Flow Control
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.33" data-path="send-guarantees.html">
            
                <a href="send-guarantees.html">
            
                    
                    Guarantees of sends and commits
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.34" data-path="undelivered-messages.html">
            
                <a href="undelivered-messages.html">
            
                    
                    Message Redelivery and Undelivered Messages
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.35" data-path="message-expiry.html">
            
                <a href="message-expiry.html">
            
                    
                    Message Expiry
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.36" data-path="large-messages.html">
            
                <a href="large-messages.html">
            
                    
                    Large Messages
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.37" data-path="paging.html">
            
                <a href="paging.html">
            
                    
                    Paging
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.38" data-path="scheduled-messages.html">
            
                <a href="scheduled-messages.html">
            
                    
                    Scheduled Messages
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.39" data-path="last-value-queues.html">
            
                <a href="last-value-queues.html">
            
                    
                    Last-Value Queues
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.40" data-path="ring-queues.html">
            
                <a href="ring-queues.html">
            
                    
                    Ring Queues
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.41" data-path="retroactive-addresses.html">
            
                <a href="retroactive-addresses.html">
            
                    
                    Retroactive Addresses
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.42" data-path="exclusive-queues.html">
            
                <a href="exclusive-queues.html">
            
                    
                    Exclusive Queues
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.43" data-path="message-grouping.html">
            
                <a href="message-grouping.html">
            
                    
                    Message Grouping
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.44" data-path="consumer-priority.html">
            
                <a href="consumer-priority.html">
            
                    
                    Consumer Priority
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.45" data-path="pre-acknowledge.html">
            
                <a href="pre-acknowledge.html">
            
                    
                    Extra Acknowledge Modes
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.46" data-path="management.html">
            
                <a href="management.html">
            
                    
                    Management
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.47" data-path="management-console.html">
            
                <a href="management-console.html">
            
                    
                    Management Console
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.48" data-path="metrics.html">
            
                <a href="metrics.html">
            
                    
                    Metrics
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.49" data-path="security.html">
            
                <a href="security.html">
            
                    
                    Security
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.50" data-path="masking-passwords.html">
            
                <a href="masking-passwords.html">
            
                    
                    Masking Passwords
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.51" data-path="broker-plugins.html">
            
                <a href="broker-plugins.html">
            
                    
                    Broker Plugins
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.52" data-path="resource-limits.html">
            
                <a href="resource-limits.html">
            
                    
                    Resource Limits
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.53" data-path="jms-bridge.html">
            
                <a href="jms-bridge.html">
            
                    
                    The JMS Bridge
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.54" data-path="client-reconnection.html">
            
                <a href="client-reconnection.html">
            
                    
                    Client Reconnection and Session Reattachment
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.55" data-path="diverts.html">
            
                <a href="diverts.html">
            
                    
                    Diverting and Splitting Message Flows
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.56" data-path="core-bridges.html">
            
                <a href="core-bridges.html">
            
                    
                    Core Bridges
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.57" data-path="transformers.html">
            
                <a href="transformers.html">
            
                    
                    Transformers
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.58" data-path="duplicate-detection.html">
            
                <a href="duplicate-detection.html">
            
                    
                    Duplicate Message Detection
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.59" data-path="clusters.html">
            
                <a href="clusters.html">
            
                    
                    Clusters
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.60" data-path="federation.html">
            
                <a href="federation.html">
            
                    
                    Federation
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.60.1" data-path="federation-address.html">
            
                <a href="federation-address.html">
            
                    
                    Address Federation
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.60.2" data-path="federation-queue.html">
            
                <a href="federation-queue.html">
            
                    
                    Queue Federation
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.61" data-path="ha.html">
            
                <a href="ha.html">
            
                    
                    High Availability and Failover
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.62" data-path="graceful-shutdown.html">
            
                <a href="graceful-shutdown.html">
            
                    
                    Graceful Server Shutdown
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.63" data-path="libaio.html">
            
                <a href="libaio.html">
            
                    
                    Libaio Native Libraries
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.64" data-path="thread-pooling.html">
            
                <a href="thread-pooling.html">
            
                    
                    Thread management
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.65" data-path="web-server.html">
            
                <a href="web-server.html">
            
                    
                    Embedded Web Server
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.66" data-path="logging.html">
            
                <a href="logging.html">
            
                    
                    Logging
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.67" data-path="rest.html">
            
                <a href="rest.html">
            
                    
                    REST Interface
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.68" data-path="embedding-activemq.html">
            
                <a href="embedding-activemq.html">
            
                    
                    Embedding the Broker
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.69" data-path="karaf.html">
            
                <a href="karaf.html">
            
                    
                    Apache Karaf
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.70" data-path="tomcat.html">
            
                <a href="tomcat.html">
            
                    
                    Apache Tomcat
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.71" data-path="spring-integration.html">
            
                <a href="spring-integration.html">
            
                    
                    Spring Integration
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.72" data-path="cdi-integration.html">
            
                <a href="cdi-integration.html">
            
                    
                    CDI Integration
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.73" data-path="intercepting-operations.html">
            
                <a href="intercepting-operations.html">
            
                    
                    Intercepting Operations
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.74" data-path="data-tools.html">
            
                <a href="data-tools.html">
            
                    
                    Data Tools
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.75" data-path="maven-plugin.html">
            
                <a href="maven-plugin.html">
            
                    
                    Maven Plugin
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.76" data-path="unit-testing.html">
            
                <a href="unit-testing.html">
            
                    
                    Unit Testing
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.77" data-path="perf-tuning.html">
            
                <a href="perf-tuning.html">
            
                    
                    Troubleshooting and Performance Tuning
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.78" data-path="configuration-index.html">
            
                <a href="configuration-index.html">
            
                    
                    Configuration Reference
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.79" data-path="restart-sequence.html">
            
                <a href="restart-sequence.html">
            
                    
                    Restart Sequence
            
                </a>
            

            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
            Published with GitBook
        </a>
    </li>
</ul>


                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href="." >Broker Connections</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
<div id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                <h1 id="broker-connections">Broker Connections</h1>
<p>Instead of waiting for clients to connect, a broker can initiate a connection to another endpoint on a specific protocol.</p>
<p>Currently, this feature supports only the AMQP protocol. However, in the future, it might be expanded to other protocols.</p>
<p>You configure broker connections using a <code>&lt;broker-connections&gt;</code> XML element in the <code>broker.xml</code> configuration file.</p>
<pre><code class="lang-xml"><span class="hljs-tag">&lt;<span class="hljs-name">broker-connections</span>&gt;</span>
    ...
<span class="hljs-tag">&lt;/<span class="hljs-name">broker-connections</span>&gt;</span>
</code></pre>
<h1 id="amqp-server-connections">AMQP Server Connections</h1>
<p>An ActiveMQ Artemis broker can initiate connections using the AMQP protocol. This means that the broker can connect to another AMQP server (not necessarily ActiveMQ Artemis) and create elements on that connection.</p>
<p>To define an AMQP broker connection, add an <code>&lt;amqp-connection&gt;</code> element within the <code>&lt;broker-connections</code> element in the <code>broker.xml</code> configuration file. For example:</p>
<pre><code class="lang-xml"><span class="hljs-tag">&lt;<span class="hljs-name">broker-connections</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">amqp-connection</span> <span class="hljs-attr">uri</span>=<span class="hljs-string">&quot;tcp://MY_HOST:MY_PORT&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;my-broker&quot;</span> <span class="hljs-attr">retry-interval</span>=<span class="hljs-string">&quot;100&quot;</span> <span class="hljs-attr">reconnect-attempts</span>=<span class="hljs-string">&quot;-1&quot;</span> <span class="hljs-attr">user</span>=<span class="hljs-string">&quot;john&quot;</span> <span class="hljs-attr">password</span>=<span class="hljs-string">&quot;doe&quot;</span>&gt;</span>
         ...
    <span class="hljs-tag">&lt;/<span class="hljs-name">amqp-connection</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">broker-connections</span>&gt;</span>
</code></pre>
<ul>
<li><code>uri</code>: tcp://host:myport (this is a required argument)</li>
<li><code>name</code>: Name of the connection used for management purposes</li>
<li><code>user</code>: User name with which to connect to the endpoint (this is an optional argument)</li>
<li><code>password</code>: Password with which to connect to the endpoint (this is an optional argument)</li>
<li><code>retry-interval</code>: Time, in milliseconds to wait before retrying a connection after an error. The default value is <code>5000</code>.</li>
<li><code>reconnect-attempts</code>: default is -1 meaning infinite</li>
<li><code>auto-start</code> : Should the broker connection start automatically with the broker. Default is <code>true</code>. If false you need to call a management operation to start it.</li>
</ul>
<p><em>Notice:</em> If you disable auto-start on the broker connection, the start of the broker connection will only happen after the management method <code>startBrokerConnection(connectionName)</code> is called on the ServerController.</p>
<p><em>Important</em>: The target endpoint needs permission for all operations that you configure. Therefore, If you are using a security manager, ensure that you perform the configured operations as a user with sufficient permissions.</p>
<h1 id="amqp-server-connection-operations">AMQP Server Connection Operations</h1>
<p>The following types of operations are supported on a AMQP server connection:</p>
<ul>
<li>Senders<ul>
<li>Messages received on specific queues are transferred to another endpoint</li>
</ul>
</li>
<li>Receivers<ul>
<li>The broker pulls messages from another endpoint</li>
</ul>
</li>
<li>Peers<ul>
<li>The broker creates both senders and receivers on another endpoint that knows how to handle them. Currently, this is implemented by Apache Qpid Dispatch.</li>
</ul>
</li>
<li>Mirrors<ul>
<li>The broker uses an AMQP connection to another broker and duplicate messages and sends acknowledgements over the wire.</li>
</ul>
</li>
</ul>
<h2 id="senders-and-receivers">Senders and Receivers</h2>
<p>It is possible to connect an ActiveMQ Artemis broker to another AMQP endpoint simply by creating a sender or receiver broker connection element.</p>
<p>For a <code>sender</code>, the broker creates a message consumer on a queue that sends messages to another AMQP endpoint.</p>
<p>For a <code>receiver</code>, the broker creates a message producer on an address that receives messages from another AMQP endpoint.</p>
<p>Both elements work like a message bridge. However, there is no additional overhead required to process messages. Senders and receivers behave just like any other consumer or producer in ActiveMQ Artemis.</p>
<p>You can configure senders or receivers for specific queues. You can also match senders and receivers to specific addresses or <em>sets</em> of addresses, using wildcard expressions. When configuring a sender or receiver, you can set the following properties:</p>
<ul>
<li><code>address-match</code>: Match the sender or receiver to a specific address or <strong>set</strong> of addresses, using a wildcard expression</li>
<li><code>queue-name</code>: Configure the sender or receiver for a specific queue</li>
</ul>
<p>Some examples are shown below.</p>
<p>Using address expressions:</p>
<pre><code class="lang-xml"><span class="hljs-tag">&lt;<span class="hljs-name">broker-connections</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">amqp-connection</span> <span class="hljs-attr">uri</span>=<span class="hljs-string">&quot;tcp://MY_HOST:MY_PORT&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;my-broker&quot;</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">sender</span> <span class="hljs-attr">address-match</span>=<span class="hljs-string">&quot;queues.#&quot;</span>/&gt;</span>
        <span class="hljs-comment">&lt;!-- notice the local queues for remotequeues.# need to be created on this broker --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">receiver</span> <span class="hljs-attr">address-match</span>=<span class="hljs-string">&quot;remotequeues.#&quot;</span>/&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">amqp-connection</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">broker-connections</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">addresses</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">address</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;remotequeues.A&quot;</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">anycast</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">queue</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;remoteQueueA&quot;</span>/&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">anycast</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">address</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">address</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;queues.B&quot;</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">anycast</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">queue</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;localQueueB&quot;</span>/&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">anycast</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">address</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">addresses</span>&gt;</span>
</code></pre>
<p>Using queue names:</p>
<pre><code class="lang-xml"><span class="hljs-tag">&lt;<span class="hljs-name">broker-connections</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">amqp-connection</span> <span class="hljs-attr">uri</span>=<span class="hljs-string">&quot;tcp://MY_HOST:MY_PORT&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;my-broker&quot;</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">receiver</span> <span class="hljs-attr">queue-name</span>=<span class="hljs-string">&quot;remoteQueueA&quot;</span>/&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">sender</span> <span class="hljs-attr">queue-name</span>=<span class="hljs-string">&quot;localQueueB&quot;</span>/&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">amqp-connection</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">broker-connections</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">addresses</span>&gt;</span>
     <span class="hljs-tag">&lt;<span class="hljs-name">address</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;remotequeues.A&quot;</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">anycast</span>&gt;</span>
           <span class="hljs-tag">&lt;<span class="hljs-name">queue</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;remoteQueueA&quot;</span>/&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">anycast</span>&gt;</span>
     <span class="hljs-tag">&lt;/<span class="hljs-name">address</span>&gt;</span>
     <span class="hljs-tag">&lt;<span class="hljs-name">address</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;queues.B&quot;</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">anycast</span>&gt;</span>
           <span class="hljs-tag">&lt;<span class="hljs-name">queue</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;localQueueB&quot;</span>/&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">anycast</span>&gt;</span>
     <span class="hljs-tag">&lt;/<span class="hljs-name">address</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">addresses</span>&gt;</span>
</code></pre>
<p><em>Important:</em> You can match a receiver only to a local queue that already exists. Therefore, if you are using receivers, make sure that you pre-create the queue locally. Otherwise, the broker cannot match the remote queues and addresses.</p>
<p><em>Important:</em> Do not create a sender and a receiver to the same destination. This creates an infinite loop of sends and receives.</p>
<h2 id="peers">Peers</h2>
<p>The broker can be configured as a peer which connects to the <a href="https://qpid.apache.org/components/dispatch-router/" target="_blank">Apache Qpid Dispatch Router</a> and instructs it the broker it will act as a store-and-forward queue for a given AMQP waypoint address configured on the router. In this scenario, clients connect to a router to send and receive messages using a waypointed address, and the router routes these messages to or from the queue on the broker.</p>
<p>The peer configuration causes ActiveMQ Artemis to create a sender and receiver pair for each destination matched in the broker-connection configuration, with these carrying special configuration to let Qpid Dispatch know to collaborate with the broker. This replaces the traditional need of a router-initiated connection and auto-links.</p>
<p>You can experiment with advanced networking scenarios with Qpid Dispatch Router and get a lot of benefit from the AMQP protocol and its ecosystem.</p>
<p>With a peer configuration, you have the same properties that you have on a sender and receiver. For example, a configuration where queues with names beginning &quot;queue.&quot; act as storage for the matching router waypoint address would be:</p>
<pre><code class="lang-xml"><span class="hljs-tag">&lt;<span class="hljs-name">broker-connections</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">amqp-connection</span> <span class="hljs-attr">uri</span>=<span class="hljs-string">&quot;tcp://MY_HOST:MY_PORT&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;my-router&quot;</span>&gt;</span>
       <span class="hljs-tag">&lt;<span class="hljs-name">peer</span> <span class="hljs-attr">address-match</span>=<span class="hljs-string">&quot;queues.#&quot;</span>/&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">amqp-connection</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">broker-connections</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-name">addresses</span>&gt;</span>
     <span class="hljs-tag">&lt;<span class="hljs-name">address</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;queues.A&quot;</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">anycast</span>&gt;</span>
           <span class="hljs-tag">&lt;<span class="hljs-name">queue</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;queues.A&quot;</span>/&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">anycast</span>&gt;</span>
     <span class="hljs-tag">&lt;/<span class="hljs-name">address</span>&gt;</span>
     <span class="hljs-tag">&lt;<span class="hljs-name">address</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;queues.B&quot;</span>&gt;</span>
     <span class="hljs-tag">&lt;<span class="hljs-name">anycast</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">queue</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;queues.B&quot;</span>/&gt;</span>
     <span class="hljs-tag">&lt;/<span class="hljs-name">anycast</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">address</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">addresses</span>&gt;</span>
</code></pre>
<p>There must be a matching address waypoint configuration on the router, instructing it that the particular router addresses the broker attaches to should be treated as waypoints. For example, a similar prefix- based router address configuration would be:</p>
<pre><code>address {
    prefix: queue
    waypoint: yes
}
</code></pre><p>For more information refer to the &quot;brokered messaging&quot; documentation for <a href="https://qpid.apache.org/components/dispatch-router/" target="_blank">Apache Qpid Dispatch Router</a>.</p>
<p><em>Important:</em> Do not use this feature to connect to another broker, otherwise any message sent will be immediately ready to consume creating an infinite echo of sends and receives.</p>
<p><em>Important:</em> You do not need to configure the router with a connector or auto-links to communicate with the broker. The brokers peer configuration replaces these aspects of the router waypoint usage.</p>
<h2 id="address-consideration">Address Consideration</h2>
<p>It is highly recommended that you keep <code>address name</code> and <code>queue name</code> the same, as when you use a queue with its distinct name (as in the following example), senders and receivers will always use the <code>address name</code> when creating the remote endpoint.</p>
<pre><code class="lang-xml"><span class="hljs-tag">&lt;<span class="hljs-name">broker-connections</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">amqp-connection</span> <span class="hljs-attr">uri</span>=<span class="hljs-string">&quot;tcp://MY_HOST:MY_PORT&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;my-broker&quot;</span>&gt;</span>
       <span class="hljs-tag">&lt;<span class="hljs-name">sender</span> <span class="hljs-attr">address-match</span>=<span class="hljs-string">&quot;queues.#&quot;</span>/&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">amqp-connection</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">broker-connections</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">addresses</span>&gt;</span>
     <span class="hljs-tag">&lt;<span class="hljs-name">address</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;queues.A&quot;</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-name">anycast</span>&gt;</span>
           <span class="hljs-tag">&lt;<span class="hljs-name">queue</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;distinctNameQueue.A&quot;</span>/&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-name">anycast</span>&gt;</span>
     <span class="hljs-tag">&lt;/<span class="hljs-name">address</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">addresses</span>&gt;</span>
</code></pre>
<p>In the above example the <code>broker connection</code> would create an AMQP sender towards &quot;queues.A&quot;. </p>
<p><em>Important:</em> To avoid confusion it is recommended that you keep the <code>address name</code> and <code>queue name</code> the same.</p>
<h2 id="mirror">Mirror</h2>
<p>The mirror option on the broker connection can capture events from the broker and pass them over the wire to another broker. This enables you to capture multiple asynchronous replicas. The following types of events are captured:</p>
<ul>
<li>Message routing</li>
<li>Message acknowledgement</li>
<li>Queue and address creation</li>
<li>queue and address deletion</li>
</ul>
<p>When you configure a mirror, these events are captured from the broker, stored on a local queue, and later forwarded to a target destination on another ActiveMQ Artemis broker.</p>
<p>To configure a mirror, you add a <code>&lt;mirror&gt;</code> element within the <code>&lt;amqp-connection&gt;</code> element.</p>
<p>The local queue is called <code>source-mirror-address</code></p>
<p>You can specify the following optional arguments.</p>
<ul>
<li><code>queue-removal</code>: Specifies whether a queue- or address-removal event is sent. The default value is <code>true</code>.</li>
<li><code>message-acknowledgements</code>: Specifies whether message acknowledgements are sent. The default value is <code>true</code>.</li>
<li><code>queue-creation</code>: Specifies whether a queue- or address-creation event is sent. The default value is <code>true</code>.</li>
<li><code>source-mirror-address</code>: By default, the mirror creates a non-durable temporary queue to store messages before they are sent to the other broker. If you define a name value for this property, an ANYCAST durable queue and address is created with the specified name.</li>
</ul>
<p>An example of a mirror configuration is shown below:</p>
<pre><code class="lang-xml"><span class="hljs-tag">&lt;<span class="hljs-name">broker-connections</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">amqp-connection</span> <span class="hljs-attr">uri</span>=<span class="hljs-string">&quot;tcp://MY_HOST:MY_PORT&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;my-mirror&quot;</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">mirror</span>  <span class="hljs-attr">queue-removal</span>=<span class="hljs-string">&quot;true&quot;</span> <span class="hljs-attr">queue-creation</span>=<span class="hljs-string">&quot;true&quot;</span> <span class="hljs-attr">message-acknowledgements</span>=<span class="hljs-string">&quot;true&quot;</span> <span class="hljs-attr">source-mirror-address</span>=<span class="hljs-string">&quot;myLocalSNFMirrorQueue&quot;</span>/&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">amqp-connection</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">broker-connections</span>&gt;</span>
</code></pre>
<p><em>Important</em>: A broker can mirror to multiple replicas (1 to many). However a replica broker can only have a single mirror source. Make sure you do not mirror multiple source brokers to a single replica broker.</p>
<h3 id="pre-existing-messages">Pre Existing Messages</h3>
<p>The broker will not send pre existing messages through the mirror. So, If you add mirror to your configuration and the journal had pre existing messages these messages will not be sent. </p>
<h2 id="broker-connection-stop-and-disconnect">Broker Connection Stop and Disconnect</h2>
<p>Once you start the broker connection with a mirror the mirror events will always be sent to the intermediate queue configured at the <code>source-mirror-address</code>.</p>
<p>It is possible to stop the broker connection with the operation stopBrokerConnection(connectionName) on the ServerControl, but it is only effective to disconnect the brokers, while the mirror events are always captured.</p>
<h2 id="disaster--recovery-considerations">Disaster &amp; Recovery Considerations</h2>
<p>As you use the mirror option to replicate data across datacenters, you have to take a few considerations:</p>
<ul>
<li>Currently we don&apos;t support quorums for activating the replica, so you have to manually control when your clients connect to the replica site.</li>
<li>Make sure the replica site is passive. Having producers and consumers connected into both sites would be messy and could lead you to data integrity issues.<ul>
<li>You can disable auto-start on the acceptor your clients use to connect, and only enable it after a disaster has occurred.</li>
</ul>
</li>
<li>Only the queues and addresses are mirrored. Consumer states will have to be reapplied on the replica when the clients reconnects (that applies to message groups, exclusive consumers or anything related to clients)</li>
<li>Make sure your configuration options are copied over, including Diverts, security, last value queues, address settings and other configuration options.</li>
<li>Have a way back route after a disaster.<ul>
<li>You can have a disabled broker connection to be enabled after the disaster.</li>
</ul>
</li>
</ul>
<h2 id="mirror-example-with-failback">Mirror example with Failback</h2>
<p>On this example lets play with two brokers:</p>
<ul>
<li>sourceBroker</li>
<li>replicaBroker</li>
</ul>
<p>Add this configuration on sourceBroker:</p>
<pre><code class="lang-xml"><span class="hljs-tag">&lt;<span class="hljs-name">broker-connections</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">amqp-connection</span> <span class="hljs-attr">uri</span>=<span class="hljs-string">&quot;tcp://replicaBroker:6700&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;DRSite&quot;</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">mirror</span> <span class="hljs-attr">message-acknowledgements</span>=<span class="hljs-string">&quot;true&quot;</span>/&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">amqp-connection</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">broker-connections</span>&gt;</span>
</code></pre>
<p>On the replicaBroker, add a disabled broker connection for failing back after a disaster, and also set the acceptors with autoStart=false</p>
<pre><code class="lang-xml">
<span class="hljs-tag">&lt;<span class="hljs-name">acceptors</span>&gt;</span>
     <span class="hljs-comment">&lt;!-- this one is for clients --&gt;</span>
     <span class="hljs-tag">&lt;<span class="hljs-name">acceptor</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;artemis&quot;</span>&gt;</span>tcp://0.0.0.0:61616?autoStart=false;tcpSendBufferSize=1048576;tcpReceiveBufferSize=1048576;amqpMinLargeMessageSize=102400;protocols=CORE,AMQP,STOMP,HORNETQ,MQTT,OPENWIRE;useEpoll=true;amqpCredits=1000;amqpLowCredits=300;amqpDuplicateDetection=true;autoStart=false<span class="hljs-tag">&lt;/<span class="hljs-name">acceptor</span>&gt;</span>
     <span class="hljs-comment">&lt;!-- this one is for DR communication --&gt;</span>
     <span class="hljs-tag">&lt;<span class="hljs-name">acceptor</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;amqp&quot;</span>&gt;</span>tcp://0.0.0.0:6700?autoStart=true;tcpSendBufferSize=1048576;tcpReceiveBufferSize=1048576;protocols=AMQP;useEpoll=true;amqpCredits=1000;amqpLowCredits=300;amqpMinLargeMessageSize=102400;amqpDuplicateDetection=true;autoStart=false<span class="hljs-tag">&lt;/<span class="hljs-name">acceptor</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">acceptors</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-name">broker-connections</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-name">amqp-connection</span> <span class="hljs-attr">uri</span>=<span class="hljs-string">&quot;tcp://sourceBroker:6700&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;failbackBroker&quot;</span> <span class="hljs-attr">auto-start</span>=<span class="hljs-string">&quot;false&quot;</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-name">mirror</span> <span class="hljs-attr">message-acknowledgements</span>=<span class="hljs-string">&quot;true&quot;</span>/&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-name">amqp-connection</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-name">broker-connections</span>&gt;</span>
</code></pre>
<p>After a failure has occurred, you can use a management operation start on the acceptor:</p>
<ul>
<li>AcceptorControl.start();</li>
</ul>
<p>And you can call startBrokerConnection to enable the failback towards the live site:</p>
<ul>
<li>ActiveMQServerControl.startBrokerConnection(&quot;failbackBroker&quot;)</li>
</ul>

                                
                                </section>
                            
    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
            
        </div>
    </div>
</div>

                        </div>
                    </div>
                
            </div>

            
                
                <a href="amqp.html" class="navigation navigation-prev " aria-label="Previous page: AMQP">
                    <i class="fa fa-angle-left"></i>
                </a>
                
                
                <a href="mqtt.html" class="navigation navigation-next " aria-label="Next page: MQTT">
                    <i class="fa fa-angle-right"></i>
                </a>
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"Broker Connections","level":"1.12.1","depth":2,"next":{"title":"MQTT","level":"1.13","depth":1,"path":"mqtt.md","ref":"mqtt.md","articles":[]},"previous":{"title":"AMQP","level":"1.12","depth":1,"path":"amqp.md","ref":"amqp.md","articles":[{"title":"Broker Connections","level":"1.12.1","depth":2,"path":"amqp-broker-connections.md","ref":"amqp-broker-connections.md","articles":[]}]},"dir":"ltr"},"config":{"plugins":[],"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"pluginsConfig":{"highlight":{},"search":{},"lunr":{"maxIndexSize":1000000,"ignoreSpecialCharacters":false},"sharing":{"facebook":true,"twitter":true,"google":false,"weibo":false,"instapaper":false,"vk":false,"all":["facebook","google","twitter","weibo","instapaper"]},"fontsettings":{"theme":"white","family":"sans","size":2},"theme-default":{"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"showLevel":false}},"github":"apache/activemq-artemis","theme":"default","githubHost":"https://github.com/","pdf":{"pageNumbers":true,"fontSize":12,"fontFamily":"Arial","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56}},"structure":{"langs":"LANGS.md","readme":"README.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"variables":{},"title":"ActiveMQ Artemis Documentation","links":{"home":"http://activemq.apache.org/artemis","issues":"https://issues.apache.org/jira/browse/ARTEMIS","contribute":"http://activemq.apache.org/contributing.html"},"gitbook":"3.x.x","description":"ActiveMQ Artemis User Guide and Reference Documentation"},"file":{"path":"amqp-broker-connections.md","mtime":"2020-11-02T23:43:03.196Z","type":"markdown"},"gitbook":{"version":"3.2.3","time":"2020-11-02T23:52:09.751Z"},"basePath":".","book":{"language":""}});
        });
    </script>
</div>

        
    <script src="gitbook/gitbook.js"></script>
    <script src="gitbook/theme.js"></script>
    
        
        <script src="gitbook/gitbook-plugin-search/search-engine.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-search/search.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-lunr/lunr.min.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-lunr/search-lunr.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-sharing/buttons.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
        
    

    </body>
</html>

